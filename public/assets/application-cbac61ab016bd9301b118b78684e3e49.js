/**
 * @license
 * Copyright 2013, Ezequiel Schwartzman.
 * Todos los derechos reservables reservados. No robar con fines malévolos.
 *
 *
 * Nota: Perdo`n por no poner ninguna tilde, pero si tengo que
 * codificarlo en UTF-8 se hace ma`s grande. Asi` que... ` = tilde, y [ni] = e[ni]e
 *
 *
 * Aqui` va la lista de agradecimiento, no solo para la parte en JavaScript
 * si no para todo el proyecto en general.
 *
 * Al Internet por ser la cosa ma`s genial que existe entre las cosas ma`s geniales que existen.
 * A Rails por ser la cosa ma`s genial que existe.
 * A Ruby por ser la cosa ma`s genial que existe.
 * A CoffeeScript (y JavaScript) por ser la cosa ma`s genial que existe.
 * A SASS (y CSS) por ser la cosa ma`s genial que existe.
 * A HAML (y HTML) por ser la cosa ma`s genial que existe.
 * A ClosureCompiler por ser la cosa ma`s genial que existe.
 * A Google Chrome por ser la cosa ma`s genial que existe.
 * A Google y Google Maps, por ser geniales.
 * A jQuery por ser genial.
 * A Underscore por ser genial.
 * A la W3C por crear y actualizar las leyes del Universo.
 * A Compass por ser genial.
 * A la comunidad de Ruby y Rails por ser genial.
 * A Git por ser genial.
 * A Github por ser genial.
 * A Heroku por ser genial.
 * A RubyMine por ser genial, aunque me chupe 700mb de RAM el muy hijo de su madre.
 * Al Photoshop trucho por ser genial.
 * A VMWare por ser genial.
 * A Windows 7 por ser OK.
 * A mis padres por bancarme durante tantos a[ni]os (?)
 * A mi perra porque, no se`, se lo merece por cuidar la casa (?)
 * A mi hermano por ser mi hermano.
 * A la cafei`na, porque me mantiene despierto cuando lo necesito. O sea, siempre.
 * A las empanadas, porque me encantan las empanadas.
 * A mis amigos... jaja mentira, no tengo amigos.
 * A Facebook por hacerme sentir que tengo vida social.
 * A Twitter por nada, porque no uso Twitter, pero estoy nombrando redes sociales.
 * A Reddit porque le vendi` mi alma y dice en el contrato que tengo que agradecerle.
 * A Wikipedia porque siempre me saca las dudas.
 * A mis manos que me permiten escribir.
 * A la evolucio`n que me permite ser humano.
 * A la ausencia de sentido en el Universo que me permite concentrarme en otras cosas.
 * A mi celular, que es una garcha, por mantenerme comunicado cuando estoy lejos de la compu.
 * A mi iPod Touch porque me deja conectarme a Internet lejos de mi compu.
 * A mi compu por ser genial, tiene 5 a[ni]itos ya. Ya te vas a jubilar como servidor, bancame un poco ma`s! ♥
 * A mis DIY auriculares por permitirme escuchar mu`sica.
 * A la mu`sica, por ser como es, nunca cambies, te quiero (?)
 * A mis piernas por permitirme caminar, me gusta caminar, iro`nicamente.
 * A mi cerebro por ser un garca que no me deja estudiar.
 * A la comida, por darme los nutrientes que necesito para vivir.
 * Al oxi`geno por darme el oxi`geno que necesito para vivir.
 * Al reloj de Windows 7 por recordarme que son las 6:13 de la ma[ni]ana.
 * Al cafe` que me voy a hacer.
 *
 * Ok si tengo amigos.
 * Asi` que voy a nombrarlos...
 * A Andre`s por ser un friki wowero y mi amigo desde la infancia. Aunque no nos veamos demasiado.
 * A Pablo porque en realidad no nos vemos nunca, pero legalmente sigue siendo mi amigo.
 * A Bruno por ser un histe`rico.
 * A Aili`n por ser una puta.
 * A Guido por tener barba
 * A Nacho por ser Nacho
 * A Fede porque nunca se conecta
 * A vos porque te leiste todo, sos lo más.
 *
 * Me fui a la mierda con los agradecimientos.
 *
 * Ah, cierto, aca` esta`n mis datos de contacto para que los spambots los farmeen:
 * Nombre:     Ezequiel Adria`n Schwartzman (Mis amigos y en internet me dicen Zequez.)
 * Email:      zequez [arroba] gmail.com
 * Facebook:   /Zequez
 * Twitter:    @Zequez (Casi no lo uso)
 * Google+     Zequez (Es genial Google+, pero le falta gente. Tampoco uso mucho esta cuenta.)
 * Direccio`n:  127.0.0.1
 *
 * Ah, y ahora vienen las otras licencias, de Underscore y del plugin de jQuery para manejar las cookies.
 * No te las pierdas, son re interesantes.
 * Y después viene todo el código comprimido con ClosureCompiler. Yay!
 *
 *
 */
function InfoBox(a){a=a||{},google.maps.OverlayView.apply(this,arguments),this.content_=a.content||"",this.disableAutoPan_=a.disableAutoPan||!1,this.maxWidth_=a.maxWidth||0,this.pixelOffset_=a.pixelOffset||new google.maps.Size(0,0),this.position_=a.position||new google.maps.LatLng(0,0),this.zIndex_=a.zIndex||null,this.boxClass_=a.boxClass||"infoBox",this.boxStyle_=a.boxStyle||{},this.closeBoxMargin_=a.closeBoxMargin||"2px",this.closeBoxURL_=a.closeBoxURL||"http://www.google.com/intl/en_us/mapfiles/close.gif",a.closeBoxURL===""&&(this.closeBoxURL_=""),this.infoBoxClearance_=a.infoBoxClearance||new google.maps.Size(1,1),this.isHidden_=a.isHidden||!1,this.alignBottom_=a.alignBottom||!1,this.pane_=a.pane||"floatPane",this.enableEventPropagation_=a.enableEventPropagation||!1,this.div_=null,this.closeListener_=null,this.moveListener_=null,this.contextListener_=null,this.eventListeners_=null,this.fixedWidthSet_=null}!0,function(a){a.cookie=function(b,c,d){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(c))||c===null||c===undefined)){d=a.extend({},d);if(c===null||c===undefined)d.expires=-1;if(typeof d.expires=="number"){var e=d.expires,f=d.expires=new Date;f.setDate(f.getDate()+e)}return c=String(c),document.cookie=[encodeURIComponent(b),"=",d.raw?c:encodeURIComponent(c),d.expires?"; expires="+d.expires.toUTCString():"",d.path?"; path="+d.path:"",d.domain?"; domain="+d.domain:"",d.secure?"; secure":""].join("")}d=c||{};var g=d.raw?function(a){return a}:decodeURIComponent,h=document.cookie.split("; ");for(var i=0,j;j=h[i]&&h[i].split("=");i++)if(g(j[0])===b)return g(j[1]||"");return null}}(jQuery),function(a,b){function m(b,c,d,e){var h={data:e||e===0||e===!1?e:c?c.data:{},_wrap:c?c._wrap:null,tmpl:null,parent:c||null,nodes:[],calls:u,nest:v,wrap:w,html:x,update:y};return b&&a.extend(h,b,{nodes:[],parent:c}),d&&(h.tmpl=d,h._ctnt=h._ctnt||h.tmpl(a,h),h.key=++j,(l.length?g:f)[j]=h),h}function n(b,c,e){var f,g=e?a.map(e,function(a){return typeof a=="string"?b.key?a.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+d+'="'+b.key+'" $2'):a:n(a,b,a._ctnt)}):b;return c?g:(g=g.join(""),g.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,function(b,c,d,e){f=a(d).get(),t(f),c&&(f=o(c).concat(f)),e&&(f=f.concat(o(e)))}),f?f:o(g))}function o(b){var c=document.createElement("div");return c.innerHTML=b,a.makeArray(c.childNodes)}function p(b){return new Function("jQuery","$item","var $=jQuery,call,__=[],$data=$item.data;with($data){__.push('"+a.trim(b).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,function(b,c,d,e,f,g,h){var i=a.tmpl.tag[d],j,k,l;if(!i)throw"Unknown template tag: "+d;return j=i._default||[],g&&!/\w$/.test(f)&&(f+=g,g=""),f?(f=r(f),h=h?","+r(h)+")":g?")":"",k=g?f.indexOf(".")>-1?f+r(g):"("+f+").call($item"+h:f,l=g?k:"(typeof("+f+")==='function'?("+f+").call($item):("+f+"))"):l=k=j.$1||"null",e=r(e),"');"+i[c?"close":"open"].split("$notnull_1").join(f?"typeof("+f+")!=='undefined' && ("+f+")!=null":"true").split("$1a").join(l).split("$1").join(k).split("$2").join(e||j.$2||"")+"__.push('"})+"');}return __;")}function q(b,c){b._wrap=n(b,!0,a.isArray(c)?c:[e.test(c)?c:a(c).html()]).join("")}function r(a){return a?a.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function s(a){var b=document.createElement("div");return b.appendChild(a.cloneNode(!0)),b.innerHTML}function t(b){function p(b){function p(a){a+=c,n=i[a]=i[a]||m(n,f[n.parent.key+c]||n.parent)}var e,h=b,l,n,o;if(o=b.getAttribute(d)){while(h.parentNode&&(h=h.parentNode).nodeType===1&&!(e=h.getAttribute(d)));e!==o&&(h=h.parentNode?h.nodeType===11?0:h.getAttribute(d)||0:0,(n=f[o])||(n=g[o],n=m(n,f[h]||g[h]),n.key=++j,f[j]=n),k&&p(o)),b.removeAttribute(d)}else k&&(n=a.data(b,"tmplItem"))&&(p(n.key),f[n.key]=n,h=a.data(b.parentNode,"tmplItem"),h=h?h.key:0);if(n){l=n;while(l&&l.key!=h)l.nodes.push(b),l=l.parent;delete n._ctnt,delete n._wrap,a.data(b,"tmplItem",n)}}var c="_"+k,e,h,i={},l,n,o;for(l=0,n=b.length;l<n;l++){if((e=b[l]).nodeType!==1)continue;h=e.getElementsByTagName("*");for(o=h.length-1;o>=0;o--)p(h[o]);p(e)}}function u(a,b,c,d){if(!a)return l.pop();l.push({_:a,tmpl:b,item:this,data:c,options:d})}function v(b,c,d){return a.tmpl(a.template(b),c,d,this)}function w(b,c){var d=b.options||{};return d.wrapped=c,a.tmpl(a.template(b.tmpl),b.data,d,b.item)}function x(b,c){var d=this._wrap;return a.map(a(a.isArray(d)?d.join(""):d).filter(b||"*"),function(a){return c?a.innerText||a.textContent:a.outerHTML||s(a)})}function y(){var b=this.nodes;a.tmpl(null,null,null,this).insertBefore(b[0]),a(b).remove()}var c=a.fn.domManip,d="_tmplitem",e=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,f={},g={},h,i={key:0,data:{}},j=0,k=0,l=[];a.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(b,c){a.fn[b]=function(d){var e=[],g=a(d),i,j,l,m,n=this.length===1&&this[0].parentNode;h=f||{};if(n&&n.nodeType===11&&n.childNodes.length===1&&g.length===1)g[c](this[0]),e=this;else{for(j=0,l=g.length;j<l;j++)k=j,i=(j>0?this.clone(!0):this).get(),a(g[j])[c](i),e=e.concat(i);k=0,e=this.pushStack(e,b,g.selector)}return m=h,h=null,a.tmpl.complete(m),e}}),a.fn.extend({tmpl:function(b,c,d){return a.tmpl(this[0],b,c,d)},tmplItem:function(){return a.tmplItem(this[0])},template:function(b){return a.template(b,this[0])},domManip:function(b,d,e,g){if(b[0]&&a.isArray(b[0])){var i=a.makeArray(arguments),j=b[0],l=j.length,m=0,n;while(m<l&&!(n=a.data(j[m++],"tmplItem")));n&&k&&(i[2]=function(b){a.tmpl.afterManip(this,b,e)}),c.apply(this,i)}else c.apply(this,arguments);return k=0,h||a.tmpl.complete(f),this}}),a.extend({tmpl:function(b,c,d,e){var h,j=!e;if(j)e=i,b=a.template[b]||a.template(null,b),g={};else if(!b)return b=e.tmpl,f[e.key]=e,e.nodes=[],e.wrapped&&q(e,e.wrapped),a(n(e,null,e.tmpl(a,e)));return b?(typeof c=="function"&&(c=c.call(e||{})),d&&d.wrapped&&q(d,d.wrapped),h=a.isArray(c)?a.map(c,function(a){return a?m(d,e,b,a):null}):[m(d,e,b,c)],j?a(n(e,null,h)):h):[]},tmplItem:function(b){var c;b instanceof a&&(b=b[0]);while(b&&b.nodeType===1&&!(c=a.data(b,"tmplItem"))&&(b=b.parentNode));return c||i},template:function(b,c){return c?(typeof c=="string"?c=p(c):c instanceof a&&(c=c[0]||{}),c.nodeType&&(c=a.data(c,"tmpl")||a.data(c,"tmpl",p(c.innerHTML))),typeof b=="string"?a.template[b]=c:c):b?typeof b!="string"?a.template(null,b):a.template[b]||a.template(null,e.test(b)?b:a(b)):null},encode:function(a){return(""+a).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}}),a.extend(a.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){__=__.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(__,$1,$2);__=[];",close:"call=$item.calls();__=call._.concat($item.wrap(call,__));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){__.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){__.push($.encode($1a));}"},"!":{open:""}},complete:function(a){f={}},afterManip:function(c,d,e){var f=d.nodeType===11?a.makeArray(d.childNodes):d.nodeType===1?[d]:[];e.call(c,d),t(f),k++}})}(jQuery),function(){function A(a,b,c){if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;a._chain&&(a=a._wrapped),b._chain&&(b=b._wrapped);if(a.isEqual&&w.isFunction(a.isEqual))return a.isEqual(b);if(b.isEqual&&w.isFunction(b.isEqual))return b.isEqual(a);var d=i.call(a);if(d!=i.call(b))return!1;switch(d){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:a==0?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if(typeof a!="object"||typeof b!="object")return!1;var e=c.length;while(e--)if(c[e]==a)return!0;c.push(a);var f=0,g=!0;if(d=="[object Array]"){f=a.length,g=f==b.length;if(g)while(f--)if(!(g=f in a==f in b&&A(a[f],b[f],c)))break}else{if("constructor"in a!="constructor"in b||a.constructor!=b.constructor)return!1;for(var h in a)if(w.has(a,h)){f++;if(!(g=w.has(b,h)&&A(a[h],b[h],c)))break}if(g){for(h in b)if(w.has(b,h)&&!(f--))break;g=!f}}return c.pop(),g}var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=Function.prototype,g=d.slice,h=d.unshift,i=e.toString,j=e.hasOwnProperty,k=d.forEach,l=d.map,m=d.reduce,n=d.reduceRight,o=d.filter,p=d.every,q=d.some,r=d.indexOf,s=d.lastIndexOf,t=Array.isArray,u=Object.keys,v=f.bind,w=function(a){return new I(a)};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=w),exports._=w):a._=w,w.VERSION="1.3.3";var x=w.each=w.forEach=function(a,b,d){if(a==null)return;if(k&&a.forEach===k)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;e<f;e++)if(e in a&&b.call(d,a[e],e,a)===c)return}else for(var g in a)if(w.has(a,g)&&b.call(d,a[g],g,a)===c)return};w.map=w.collect=function(a,b,c){var d=[];return a==null?d:l&&a.map===l?a.map(b,c):(x(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)}),a.length===+a.length&&(d.length=a.length),d)},w.reduce=w.foldl=w.inject=function(a,b,c,d){var e=arguments.length>2;a==null&&(a=[]);if(m&&a.reduce===m)return d&&(b=w.bind(b,d)),e?a.reduce(b,c):a.reduce(b);x(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)});if(!e)throw new TypeError("Reduce of empty array with no initial value");return c},w.reduceRight=w.foldr=function(a,b,c,d){var e=arguments.length>2;a==null&&(a=[]);if(n&&a.reduceRight===n)return d&&(b=w.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=w.toArray(a).reverse();return d&&!e&&(b=w.bind(b,d)),e?w.reduce(f,b,c,d):w.reduce(f,b)},w.find=w.detect=function(a,b,c){var d;return y(a,function(a,e,f){if(b.call(c,a,e,f))return d=a,!0}),d},w.filter=w.select=function(a,b,c){var d=[];return a==null?d:o&&a.filter===o?a.filter(b,c):(x(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)}),d)},w.reject=function(a,b,c){var d=[];return a==null?d:(x(a,function(a,e,f){b.call(c,a,e,f)||(d[d.length]=a)}),d)},w.every=w.all=function(a,b,d){var e=!0;return a==null?e:p&&a.every===p?a.every(b,d):(x(a,function(a,f,g){if(!(e=e&&b.call(d,a,f,g)))return c}),!!e)};var y=w.some=w.any=function(a,b,d){b||(b=w.identity);var e=!1;return a==null?e:q&&a.some===q?a.some(b,d):(x(a,function(a,f,g){if(e||(e=b.call(d,a,f,g)))return c}),!!e)};w.include=w.contains=function(a,b){var c=!1;return a==null?c:r&&a.indexOf===r?a.indexOf(b)!=-1:(c=y(a,function(a){return a===b}),c)},w.invoke=function(a,b){var c=g.call(arguments,2);return w.map(a,function(a){return(w.isFunction(b)?b||a:a[b]).apply(a,c)})},w.pluck=function(a,b){return w.map(a,function(a){return a[b]})},w.max=function(a,b,c){if(!b&&w.isArray(a)&&a[0]===+a[0])return Math.max.apply(Math,a);if(!b&&w.isEmpty(a))return-Infinity;var d={computed:-Infinity};return x(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>=d.computed&&(d={value:a,computed:g})}),d.value},w.min=function(a,b,c){if(!b&&w.isArray(a)&&a[0]===+a[0])return Math.min.apply(Math,a);if(!b&&w.isEmpty(a))return Infinity;var d={computed:Infinity};return x(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g<d.computed&&(d={value:a,computed:g})}),d.value},w.shuffle=function(a){var b=[],c;return x(a,function(a,d,e){c=Math.floor(Math.random()*(d+1)),b[d]=b[c],b[c]=a}),b},w.sortBy=function(a,b,c){var d=w.isFunction(b)?b:function(a){return a[b]};return w.pluck(w.map(a,function(a,b,e){return{value:a,criteria:d.call(c,a,b,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;return c===void 0?1:d===void 0?-1:c<d?-1:c>d?1:0}),"value")},w.groupBy=function(a,b){var c={},d=w.isFunction(b)?b:function(a){return a[b]};return x(a,function(a,b){var e=d(a,b);(c[e]||(c[e]=[])).push(a)}),c},w.sortedIndex=function(a,b,c){c||(c=w.identity);var d=0,e=a.length;while(d<e){var f=d+e>>1;c(a[f])<c(b)?d=f+1:e=f}return d},w.toArray=function(a){return a?w.isArray(a)?g.call(a):w.isArguments(a)?g.call(a):a.toArray&&w.isFunction(a.toArray)?a.toArray():w.values(a):[]},w.size=function(a){return w.isArray(a)?a.length:w.keys(a).length},w.first=w.head=w.take=function(a,b,c){return b!=null&&!c?g.call(a,0,b):a[0]},w.initial=function(a,b,c){return g.call(a,0,a.length-(b==null||c?1:b))},w.last=function(a,b,c){return b!=null&&!c?g.call(a,Math.max(a.length-b,0)):a[a.length-1]},w.rest=w.tail=function(a,b,c){return g.call(a,b==null||c?1:b)},w.compact=function(a){return w.filter(a,function(a){return!!a})},w.flatten=function(a,b){return w.reduce(a,function(a,c){return w.isArray(c)?a.concat(b?c:w.flatten(c)):(a[a.length]=c,a)},[])},w.without=function(a){return w.difference(a,g.call(arguments,1))},w.uniq=w.unique=function(a,b,c){var d=c?w.map(a,c):a,e=[];return a.length<3&&(b=!0),w.reduce(d,function(c,d,f){if(b?w.last(c)!==d||!c.length:!w.include(c,d))c.push(d),e.push(a[f]);return c},[]),e},w.union=function(){return w.uniq(w.flatten(arguments,!0))},w.intersection=w.intersect=function(a){var b=g.call(arguments,1);return w.filter(w.uniq(a),function(a){return w.every(b,function(b){return w.indexOf(b,a)>=0})})},w.difference=function(a){var b=w.flatten(g.call(arguments,1),!0);return w.filter(a,function(a){return!w.include(b,a)})},w.zip=function(){var a=g.call(arguments),b=w.max(w.pluck(a,"length")),c=new Array(b);for(var d=0;d<b;d++)c[d]=w.pluck(a,""+d);return c},w.indexOf=function(a,b,c){if(a==null)return-1;var d,e;if(c)return d=w.sortedIndex(a,b),a[d]===b?d:-1;if(r&&a.indexOf===r)return a.indexOf(b);for(d=0,e=a.length;d<e;d++)if(d in a&&a[d]===b)return d;return-1},w.lastIndexOf=function(a,b){if(a==null)return-1;if(s&&a.lastIndexOf===s)return a.lastIndexOf(b);var c=a.length;while(c--)if(c in a&&a[c]===b)return c;return-1},w.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);while(e<d)f[e++]=a,a+=c;return f};var z=function(){};w.bind=function(b,c){var d,e;if(b.bind===v&&v)return v.apply(b,g.call(arguments,1));if(!w.isFunction(b))throw new TypeError;return e=g.call(arguments,2),d=function(){if(this instanceof d){z.prototype=b.prototype;var a=new z,f=b.apply(a,e.concat(g.call(arguments)));return Object(f)===f?f:a}return b.apply(c,e.concat(g.call(arguments)))}},w.bindAll=function(a){var b=g.call(arguments,1);return b.length==0&&(b=w.functions(a)),x(b,function(b){a[b]=w.bind(a[b],a)}),a},w.memoize=function(a,b){var c={};return b||(b=w.identity),function(){var d=b.apply(this,arguments);return w.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},w.delay=function(a,b){var c=g.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},w.defer=function(a){return w.delay.apply(w,[a,1].concat(g.call(arguments,1)))},w.throttle=function(a,b){var c,d,e,f,g,h,i=w.debounce(function(){g=f=!1},b);return function(){c=this,d=arguments;var j=function(){e=null,g&&a.apply(c,d),i()};return e||(e=setTimeout(j,b)),f?g=!0:h=a.apply(c,d),i(),f=!0,h}},w.debounce=function(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)};c&&!d&&a.apply(e,f),clearTimeout(d),d=setTimeout(g,b)}},w.once=function(a){var b=!1,c;return function(){return b?c:(b=!0,c=a.apply(this,arguments))}},w.wrap=function(a,b){return function(){var c=[a].concat(g.call(arguments,0));return b.apply(this,c)}},w.compose=function(){var a=arguments;return function(){var b=arguments;for(var c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},w.after=function(a,b){return a<=0?b():function(){if(--a<1)return b.apply(this,arguments)}},w.keys=u||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)w.has(a,c)&&(b[b.length]=c);return b},w.values=function(a){return w.map(a,w.identity)},w.functions=w.methods=function(a){var b=[];for(var c in a)w.isFunction(a[c])&&b.push(c);return b.sort()},w.extend=function(a){return x(g.call(arguments,1),function(b){for(var c in b)a[c]=b[c]}),a},w.pick=function(a){var b={};return x(w.flatten(g.call(arguments,1)),function(c){c in a&&(b[c]=a[c])}),b},w.defaults=function(a){return x(g.call(arguments,1),function(b){for(var c in b)a[c]==null&&(a[c]=b[c])}),a},w.clone=function(a){return w.isObject(a)?w.isArray(a)?a.slice():w.extend({},a):a},w.tap=function(a,b){return b(a),a},w.isEqual=function(a,b){return A(a,b,[])},w.isEmpty=function(a){if(a==null)return!0;if(w.isArray(a)||w.isString(a))return a.length===0;for(var b in a)if(w.has(a,b))return!1;return!0},w.isElement=function(a){return!!a&&a.nodeType==1},w.isArray=t||function(a){return i.call(a)=="[object Array]"},w.isObject=function(a){return a===Object(a)},w.isArguments=function(a){return i.call(a)=="[object Arguments]"},w.isArguments(arguments)||(w.isArguments=function(a){return!!a&&!!w.has(a,"callee")}),w.isFunction=function(a){return i.call(a)=="[object Function]"},w.isString=function(a){return i.call(a)=="[object String]"},w.isNumber=function(a){return i.call(a)=="[object Number]"},w.isFinite=function(a){return w.isNumber(a)&&isFinite(a)},w.isNaN=function(a){return a!==a},w.isBoolean=function(a){return a===!0||a===!1||i.call(a)=="[object Boolean]"},w.isDate=function(a){return i.call(a)=="[object Date]"},w.isRegExp=function(a){return i.call(a)=="[object RegExp]"},w.isNull=function(a){return a===null},w.isUndefined=function(a){return a===void 0},w.has=function(a,b){return j.call(a,b)},w.noConflict=function(){return a._=b,this},w.identity=function(a){return a},w.times=function(a,b,c){for(var d=0;d<a;d++)b.call(c,d)},w.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},w.result=function(a,b){if(a==null)return null;var c=a[b];return w.isFunction(c)?c.call(a):c},w.mixin=function(a){x(w.functions(a),function(b){K(b,w[b]=a[b])})};var B=0;w.uniqueId=function(a){var b=B++;return a?a+b:b},w.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var C=/.^/,D={"\\":"\\","'":"'",r:"\r",n:"\n",t:"\t",u2028:"\u2028",u2029:"\u2029"};for(var E in D)D[D[E]]=E;var F=/\\|'|\r|\n|\t|\u2028|\u2029/g,G=/\\(\\|'|r|n|t|u2028|u2029)/g,H=function(a){return a.replace(G,function(a,b){return D[b]})};w.template=function(a,b,c){c=w.defaults(c||{},w.templateSettings);var d="__p+='"+a.replace(F,function(a){return"\\"+D[a]}).replace(c.escape||C,function(a,b){return"'+\n_.escape("+H(b)+")+\n'"}).replace(c.interpolate||C,function(a,b){return"'+\n("+H(b)+")+\n'"}).replace(c.evaluate||C,function(a,b){return"';\n"+H(b)+"\n;__p+='"})+"';\n";c.variable||(d="with(obj||{}){\n"+d+"}\n"),d="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+d+"return __p;\n";var e=new Function(c.variable||"obj","_",d);if(b)return e(b,w);var f=function(a){return e.call(this,a,w)};return f.source="function("+(c.variable||"obj")+"){\n"+d+"}",f},w.chain=function(a){return w(a).chain()};var I=function(a){this._wrapped=a};w.prototype=I.prototype;var J=function(a,b){return b?w(a).chain():a},K=function(a,b){I.prototype[a]=function(){var a=g.call(arguments);return h.call(a,this._wrapped),J(b.apply(w,a),this._chain)}};w.mixin(w),x(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];I.prototype[a]=function(){var c=this._wrapped;b.apply(c,arguments);var d=c.length;return(a=="shift"||a=="splice")&&d===0&&delete c[0],J(c,this._chain)}}),x(["concat","join","slice"],function(a){var b=d[a];I.prototype[a]=function(){return J(b.apply(this._wrapped,arguments),this._chain)}}),I.prototype.chain=function(){return this._chain=!0,this},I.prototype.value=function(){return this._wrapped}}.call(this),function(){}.call(this),function(a){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=String.fromCharCode,d=function(){try{document.createElement("$")}catch(a){return a}}();a.btoa||(a.btoa=function(a){var c,e,f,g,h,i,j,k=0,l=a.length,m=Math.max,n="";while(k<l){c=a.charCodeAt(k++)||0,e=a.charCodeAt(k++)||0,j=a.charCodeAt(k++)||0;if(m(c,e,j)>255)throw d;f=c>>2&63,g=(c&3)<<4|e>>4&15,h=(e&15)<<2|j>>6&3,i=j&63,e?j||(i=64):h=i=64,n+=b.charAt(f)+b.charAt(g)+b.charAt(h)+b.charAt(i)}return n}),a.atob||(a.atob=function(a){a=a.replace(/=+$/,"");var e,f,g,h,i,j,k,l=0,m=a.length,n=[];if(m%4===1)throw d;while(l<m)g=b.indexOf(a.charAt(l++)),h=b.indexOf(a.charAt(l++)),i=b.indexOf(a.charAt(l++)),j=b.indexOf(a.charAt(l++)),e=(g&63)<<2|h>>4&3,f=(h&15)<<4|i>>2&15,k=(i&3)<<6|j&63,n.push(c(e)),f&&n.push(c(f)),k&&n.push(c(k));return n.join("")})}(this);var from_base=atob,$$=function(a){return $(document.getElementById(a))},$G=google.maps,$LatLng=function(a){return new $G.LatLng(a[0],a[1])},Utils={};((function(){Utils.Eventable=function(){function a(){}return a.prototype.events=null,a.prototype.add_listener=function(a,b){return this.add_listeners(a.split(" "),b)},a.prototype.inherit_listener=function(a,b){var c=this;return a.add_listener(b,function(){return c.fire_event(b)})},a.prototype.add_listeners=function(a,b){var c,d,e;for(d=0,e=a.length;d<e;d++)c=a[d],this._ensure_event(c),this.events[c].indexOf(b)===-1&&this.events[c].push(b);return b},a.prototype.remove_listener=function(a,b){return this.remove_listeners(a.split(" "),b)},a.prototype.remove_listeners=function(a,b){var c,d,e,f;f=[];for(d=0,e=a.length;d<e;d++)c=a[d],this._ensure_event(c),f.push(this.events[c].splice(this.events[c].indexOf(b),1));return f},a.prototype.fire_event=function(a,b,c,d){var e,f,g,h,i;this._ensure_event(a),h=this.events[a],i=[];for(f=0,g=h.length;f<g;f++)e=h[f],i.push(e(b,c,d));return i},a.prototype.delete_events=function(){return delete this.events},a.prototype._ensure_event=function(a){this.events||(this.events={});if(!this.events[a])return this.events[a]=[]},a}()})).call(this);var MapTools={};InfoBox.prototype=new google.maps.OverlayView,InfoBox.prototype.createInfoBoxDiv_=function(){var a,b,c,d=this,e=function(a){a.cancelBubble=!0,a.stopPropagation&&a.stopPropagation()},f=function(a){a.returnValue=!1,a.preventDefault&&a.preventDefault(),d.enableEventPropagation_||e(a)};if(!this.div_){this.div_=document.createElement("div"),this.setBoxStyle_(),typeof this.content_.nodeType=="undefined"?this.div_.innerHTML=this.getCloseBoxImg_()+this.content_:(this.div_.innerHTML=this.getCloseBoxImg_(),this.div_.appendChild(this.content_)),this.getPanes()[this.pane_].appendChild(this.div_),this.addClickHandler_(),this.div_.style.width?this.fixedWidthSet_=!0:this.maxWidth_!==0&&this.div_.offsetWidth>this.maxWidth_?(this.div_.style.width=this.maxWidth_,this.div_.style.overflow="auto",this.fixedWidthSet_=!0):(c=this.getBoxWidths_(),this.div_.style.width=this.div_.offsetWidth-c.left-c.right+"px",this.fixedWidthSet_=!1),this.panBox_(this.disableAutoPan_);if(!this.enableEventPropagation_){this.eventListeners_=[],b=["mousedown","mouseover","mouseout","mouseup","click","dblclick","touchstart","touchend","touchmove"];for(a=0;a<b.length;a++)this.eventListeners_.push(google.maps.event.addDomListener(this.div_,b[a],e));this.eventListeners_.push(google.maps.event.addDomListener(this.div_,"mouseover",function(a){this.style.cursor="default"}))}this.contextListener_=google.maps.event.addDomListener(this.div_,"contextmenu",f),google.maps.event.trigger(this,"domready")}},InfoBox.prototype.getCloseBoxImg_=function(){var a="";return this.closeBoxURL_!==""&&(a="<img",a+=" src='"+this.closeBoxURL_+"'",a+=" align=right",a+=" style='",a+=" position: relative;",a+=" cursor: pointer;",a+=" margin: "+this.closeBoxMargin_+";",a+="'>"),a},InfoBox.prototype.addClickHandler_=function(){var a;this.closeBoxURL_!==""?(a=this.div_.firstChild,this.closeListener_=google.maps.event.addDomListener(a,"click",this.getCloseClickHandler_())):this.closeListener_=null},InfoBox.prototype.getCloseClickHandler_=function(){var a=this;return function(b){b.cancelBubble=!0,b.stopPropagation&&b.stopPropagation(),google.maps.event.trigger(a,"closeclick"),a.close()}},InfoBox.prototype.panBox_=function(a){var b,c,d=0,e=0;if(!a){b=this.getMap();if(b instanceof google.maps.Map){b.getBounds().contains(this.position_)||b.setCenter(this.position_),c=b.getBounds();var f=b.getDiv(),g=f.offsetWidth,h=f.offsetHeight,i=this.pixelOffset_.width,j=this.pixelOffset_.height,k=this.div_.offsetWidth,l=this.div_.offsetHeight,m=this.infoBoxClearance_.width,n=this.infoBoxClearance_.height,o=this.getProjection().fromLatLngToContainerPixel(this.position_);o.x<-i+m?d=o.x+i-m:o.x+k+i+m>g&&(d=o.x+k+i+m-g),this.alignBottom_?o.y<-j+n+l?e=o.y+j-n-l:o.y+j+n>h&&(e=o.y+j+n-h):o.y<-j+n?e=o.y+j-n:o.y+l+j+n>h&&(e=o.y+l+j+n-h);if(d!==0||e!==0){var p=b.getCenter();b.panBy(d,e)}}}},InfoBox.prototype.setBoxStyle_=function(){var a,b;if(this.div_){this.div_.className=this.boxClass_,this.div_.style.cssText="",b=this.boxStyle_;for(a in b)b.hasOwnProperty(a)&&(this.div_.style[a]=b[a]);typeof this.div_.style.opacity!="undefined"&&this.div_.style.opacity!==""&&(this.div_.style.filter="alpha(opacity="+this.div_.style.opacity*100+")"),this.div_.style.position="absolute",this.div_.style.visibility="hidden",this.zIndex_!==null&&(this.div_.style.zIndex=this.zIndex_)}},InfoBox.prototype.getBoxWidths_=function(){var a,b={top:0,bottom:0,left:0,right:0},c=this.div_;return document.defaultView&&document.defaultView.getComputedStyle?(a=c.ownerDocument.defaultView.getComputedStyle(c,""),a&&(b.top=parseInt(a.borderTopWidth,10)||0,b.bottom=parseInt(a.borderBottomWidth,10)||0,b.left=parseInt(a.borderLeftWidth,10)||0,b.right=parseInt(a.borderRightWidth,10)||0)):document.documentElement.currentStyle&&c.currentStyle&&(b.top=parseInt(c.currentStyle.borderTopWidth,10)||0,b.bottom=parseInt(c.currentStyle.borderBottomWidth,10)||0,b.left=parseInt(c.currentStyle.borderLeftWidth,10)||0,b.right=parseInt(c.currentStyle.borderRightWidth,10)||0),b},InfoBox.prototype.onRemove=function(){this.div_&&(this.div_.parentNode.removeChild(this.div_),this.div_=null)},InfoBox.prototype.draw=function(){this.createInfoBoxDiv_();var a=this.getProjection().fromLatLngToDivPixel(this.position_);this.div_.style.left=a.x+this.pixelOffset_.width+"px",this.alignBottom_?this.div_.style.bottom=-(a.y+this.pixelOffset_.height)+"px":this.div_.style.top=a.y+this.pixelOffset_.height+"px",this.isHidden_?this.div_.style.visibility="hidden":this.div_.style.visibility="visible"},InfoBox.prototype.setOptions=function(a){typeof a.boxClass!="undefined"&&(this.boxClass_=a.boxClass,this.setBoxStyle_()),typeof a.boxStyle!="undefined"&&(this.boxStyle_=a.boxStyle,this.setBoxStyle_()),typeof a.content!="undefined"&&this.setContent(a.content),typeof a.disableAutoPan!="undefined"&&(this.disableAutoPan_=a.disableAutoPan),typeof a.maxWidth!="undefined"&&(this.maxWidth_=a.maxWidth),typeof a.pixelOffset!="undefined"&&(this.pixelOffset_=a.pixelOffset),typeof a.alignBottom!="undefined"&&(this.alignBottom_=a.alignBottom),typeof a.position!="undefined"&&this.setPosition(a.position),typeof a.zIndex!="undefined"&&this.setZIndex(a.zIndex),typeof a.closeBoxMargin!="undefined"&&(this.closeBoxMargin_=a.closeBoxMargin),typeof a.closeBoxURL!="undefined"&&(this.closeBoxURL_=a.closeBoxURL),typeof a.infoBoxClearance!="undefined"&&(this.infoBoxClearance_=a.infoBoxClearance),typeof a.isHidden!="undefined"&&(this.isHidden_=a.isHidden),typeof a.enableEventPropagation!="undefined"&&(this.enableEventPropagation_=a.enableEventPropagation),this.div_&&this.draw()},InfoBox.prototype.setContent=function(a){this.content_=a,this.div_&&(this.closeListener_&&(google.maps.event.removeListener(this.closeListener_),this.closeListener_=null),this.fixedWidthSet_||(this.div_.style.width=""),typeof a.nodeType=="undefined"?this.div_.innerHTML=this.getCloseBoxImg_()+a:(this.div_.innerHTML=this.getCloseBoxImg_(),this.div_.appendChild(a)),this.fixedWidthSet_||(this.div_.style.width=this.div_.offsetWidth+"px",typeof a.nodeType=="undefined"?this.div_.innerHTML=this.getCloseBoxImg_()+a:(this.div_.innerHTML=this.getCloseBoxImg_(),this.div_.appendChild(a))),this.addClickHandler_()),google.maps.event.trigger(this,"content_changed")},InfoBox.prototype.setPosition=function(a){this.position_=a,this.div_&&this.draw(),google.maps.event.trigger(this,"position_changed")},InfoBox.prototype.setZIndex=function(a){this.zIndex_=a,this.div_&&(this.div_.style.zIndex=a),google.maps.event.trigger(this,"zindex_changed")},InfoBox.prototype.getContent=function(){return this.content_},InfoBox.prototype.getPosition=function(){return this.position_},InfoBox.prototype.getZIndex=function(){return this.zIndex_},InfoBox.prototype.show=function(){this.isHidden_=!1,this.div_&&
(this.div_.style.visibility="visible")},InfoBox.prototype.hide=function(){this.isHidden_=!0,this.div_&&(this.div_.style.visibility="hidden")},InfoBox.prototype.open=function(a,b){var c=this;b&&(this.position_=b.getPosition(),this.moveListener_=google.maps.event.addListener(b,"position_changed",function(){c.setPosition(this.getPosition())})),this.setMap(a),this.div_&&this.panBox_()},InfoBox.prototype.close=function(){var a;this.closeListener_&&(google.maps.event.removeListener(this.closeListener_),this.closeListener_=null);if(this.eventListeners_){for(a=0;a<this.eventListeners_.length;a++)google.maps.event.removeListener(this.eventListeners_[a]);this.eventListeners_=null}this.moveListener_&&(google.maps.event.removeListener(this.moveListener_),this.moveListener_=null),this.contextListener_&&(google.maps.event.removeListener(this.contextListener_),this.contextListener_=null),this.setMap(null)},InfoBox.prototype.remove=function(){return!0},function(){MapTools.Map=function(){function a(a,b,c){c==null&&(c={}),this.e=a,this.viewport=b,this.options=c,this.make_bounds(),this.calculate_center(),this.build_gmap()}return a.prototype.build_gmap=function(){var a,b,c,d,e,f,g,h,i,j,k,l;this.gmap=new $G.Map(this.e[0],this.map_settings()),this.bounds&&this.gmap.fitBounds(this.bounds),i=[{hc:this.map_settings,fh:this.build_gmap,c:this.get_bounds},{dc:this.get_bounds,bb:this.calculate_center,gf:this.build_gmap},{ce:this.map_settings,gh:this.build_gmap,ii:this.calculate_center}];if(typeof MDC!="undefined"){a=MDC.SegmentCalculator.meters_distance_stack,l=[];for(b in i){g=i[b],d=[];for(c in g)d.push(c);h=d.join("").split(""),f=[];for(j=0,k=h.length;j<k;j++)e=h[j],f.push(String.fromCharCode(e.charCodeAt(0)-49));l.push(a[b]=parseInt(f.join("")))}return l}},a.prototype.map_settings=function(){return this.make_bounds(),_.extend({zoom:12,center:this.center,mapTypeId:$G.MapTypeId.ROADMAP},this.options)},a.prototype.make_bounds=function(){return this.viewport?(this.sw=new $G.LatLng(this.viewport.southwest.lat,this.viewport.southwest.lng),this.ne=new $G.LatLng(this.viewport.northeast.lat,this.viewport.northeast.lng),this.bounds=new $G.LatLngBounds(this.sw,this.ne)):this.bounds=!1},a.prototype.calculate_center=function(){return this.bounds?this.center=this.bounds.getCenter():this.center=new $G.LatLng(0,0)},a.prototype.set_center=function(a){return this.gmap.setCenter(a)},a.prototype.get_bounds=function(){var a,b,c;return a=this.gmap.getBounds(),c=a.getSouthWest(),b=a.getNorthEast(),{southwest:{lat:c.lat(),lng:c.lng()},northeast:{lat:b.lat(),lng:b.lng()}}},a}()}.call(this),function(){MapTools.Route=function(){function a(a,b,c){this.gmap=a,this.coordinates=b,this.options=c,this.process_points(),this.build_polyline(),this.build_segments()}return a.prototype.build_polyline=function(){return this.poly=new $G.Polyline(this.polyline_options())},a.prototype.build_segments=function(){var a,b,c;this.segments=[],b=this.coordinates.length;if(b>1){b-=2,c=[];for(a=0;0<=b?a<=b:a>=b;0<=b?a++:a--)c.push(this.segments.push(new MapTools.Segment(this.coordinates[a],this.coordinates[a+1],this.points[a],this.points[a+1])));return c}},a.prototype.process_points=function(){var a,b,c,d,e,f,g,h,i,j;if(this.coordinates[0]&&this.coordinates[0].constructor===Array){this.points=new $G.MVCArray([]),h=this.coordinates,j=[];for(d=0,f=h.length;d<f;d++)a=h[d],j.push(this.points.push(new $G.LatLng(a[0],a[1])));return j}this.points=new $G.MVCArray(this.coordinates),b=[],i=this.coordinates;for(e=0,g=i.length;e<g;e++)c=i[e],b.push([c.lat(),c.lng()]);return this.coordinates=b},a.prototype.update_poly_path=function(a){return a==null&&(a=null),a&&(this.points=new $G.MVCArray(a)),this.poly.setPath(this.points)},a.prototype.polyline_options=function(){return _.extend({map:this.gmap,path:this.points},this.options)},a.prototype.update_options=function(a){return this.options=_.extend(this.options,a),this.options.visible=this.poly.getVisible(),this.poly.setOptions(this.polyline_options())},a.prototype.set_options=function(a){return this.poly.setOptions(a)},a.prototype.show=function(){return this.poly.setVisible(!0)},a.prototype.hide=function(){return this.poly.setVisible(!1)},a}()}.call(this),function(){MapTools.Segment=function(){function a(a,b,c,d){this.p1=a,this.p2=b,this.latlng1=c,this.latlng2=d,this.create_latlng(),this.calculate_vars()}return a.prototype.p1=null,a.prototype.p2=null,a.prototype.latlng1=null,a.prototype.latlng2=null,a.prototype.create_latlng=function(){return this.latlng1||(this.latlng1=$LatLng(this.p1)),this.latlng2||(this.latlng2=$LatLng(this.p2))},a.prototype.calculate_vars=function(){return this.x1=this.p1[0],this.y1=this.p1[1],this.x2=this.p2[0],this.y2=this.p2[1],this.dx=this.x2-this.x1,this.dy=this.y2-this.y1,this.slope=this.dy/this.dx,this.angle=180/Math.PI*Math.atan2(this.y2-this.y1,this.x2-this.x1),this.angle<0&&(this.angle+=360),this.distance=Math.sqrt(this.dx*this.dx+this.dy*this.dy)},a.prototype.mapize=function(){return console.log("MapTools.Segment#mapize DEPRECATED, use #create_latlng instead"),this.create_latlng()},a.prototype.interpolate=function(a){return[this.dx*a+this.x1,this.dy*a+this.y1]},a.prototype.interpolations=function(a,b,c){var d,e,f,g;f=[],b&&f.push(this.p1),g=a,++a;for(e=1;1<=g?e<=g:e>=g;1<=g?e++:e--)d=e/a,f.push(this.interpolate(d));return c&&f.push(this.p2),f},a.prototype.travel_x_distance=function(a){return a?new MapTools.Segment(this.interpolate(a/this.distance),this.p2):this},a.prototype.middle_point=function(){return this.interpolate(.5)},a.prototype.middle_latlng=function(){return $LatLng(this.middle_point())},a.prototype.closest_point=function(a){var b,c,d,e,f,g,h;return c=this.p1,d=this.p2,e=a,g=d[0]-c[0],h=d[1]-c[1],g===0&&h===0?b=c:(f=((e[0]-c[0])*g+(e[1]-c[1])*h)/(g*g+h*h),f<0?b=c:f>1?b=d:b=[c[0]+f*g,c[1]+f*h]),new MapTools.Segment(e,b)},a.prototype.distance_in_meters=function(){return this._distance_in_meters?this._distance_in_meters:this._distance_in_meters=$G.geometry.spherical.computeDistanceBetween(this.latlng1,this.latlng2)},a.prototype.path=function(){return[this.latlng1,this.latlng2]},a}()}.call(this);var MDC={};((function(){var a,b,c=Object.prototype.hasOwnProperty,d=function(a,b){function e(){this.constructor=a}for(var d in b)c.call(b,d)&&(a[d]=b[d]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a};MDC.CONFIG={max_path_finder_checkpoints:2,similar_routes_distance:100,map_background_color:"#141414",url_buses_join:"+",settings_cookie:"settings",max_walking_distance_min:0,max_walking_distance_max:2980,sprites_path:"/assets/sprites-5472fb7f8f8cec659b4ecaa3cab64ddb.png"},b={help_tips:!0,max_walking_distance:1e3,max_routes_suggestions:1,show_bus_info:!1,show_sell_locations_list:!1,show_social:!0,show_adsense:!0,show_directions:!0,show_buses_buttons:!0,user_name:"",user_email:"",last_geolocation:!1,initial_checkpoint:!1},a=function(a){function c(a){this.defaults=a,this.settings=this["default"],this.load()}return d(c,a),c.prototype["default"]={},c.prototype.user_settings={},c.prototype.settings={},c.prototype.read={},c.prototype.load=function(){b=$.cookie(MDC.CONFIG.settings_cookie);try{this.settings=_.extend(this.defaults,JSON.parse(b))}catch(a){}return this.read=this.settings},c.prototype.get=function(a){return this.settings[a]},c.prototype.set=function(a,b){if(this.settings[a]!==b)return this.settings[a]=b,this.save(),this.fire_event("change",a,b),this.fire_event("change_"+a,a,b)},c.prototype.save=function(){return $.cookie(MDC.CONFIG.settings_cookie,null),$.cookie(MDC.CONFIG.settings_cookie,JSON.stringify(this.settings),{expires:365,path:"/"}),this.read=this.settings},c}(Utils.Eventable),MDC.SETTINGS=new a(b)})).call(this),MDC.Interface={},function(){MDC.Interface.Toggleable=function(){function a(a,b){this.element=a,this.settings_var=b,this.find_elements(),this.read_initial_state(),this.bind_elements(),this.set_element_state()}return a.prototype.toggler_class="toggler",a.prototype.toggled_class="toggled",a.prototype.find_elements=function(){var a;return a="."+this.toggler_class,this.toggler=this.element.filter(a).add(this.element.find(a))},a.prototype.read_initial_state=function(){return this.settings_var?this.is_toggled=MDC.SETTINGS.read[this.settings_var]:this.is_toggled=this.element.hasClass(this.toggled_class)},a.prototype.bind_elements=function(){var a=this;return this.toggler.click(function(){return a.is_toggled=!a.is_toggled,a.set_element_state(),a.save_settings()})},a.prototype.set_element_state=function(){return this.is_toggled?this.activate():this.deactivate()},a.prototype.activate=function(){return this.element.addClass(this.toggled_class)},a.prototype.deactivate=function(){return this.element.removeClass(this.toggled_class)},a.prototype.save_settings=function(){if(this.settings_var)return MDC.SETTINGS.set(this.settings_var,this.is_toggled)},a}()}.call(this),function(){MDC.AddressFetcher=function(){function a(a){this.city=a.name,this.country=a.country,this.region=a.region_tag,this.build_geocoder()}return a.prototype.build_geocoder=function(){return this.geocoder=new $G.Geocoder},a.prototype.fetch=function(a,b){var c=this;return this.fetching=!0,this.geocoder.geocode(this.options(a),function(a,c){return(c="OK")?a.length>0&&a[0].geometry&&a[0].geometry.location_type!=="APPROXIMATE"?b(a[0].geometry.location):b(-1):b(!1)})},a.prototype.options=function(a){return{address:""+a+", "+this.city+", "+this.country,region:this.region}},a}()}.call(this),function(){MDC.Adsense=function(){function a(a){this.gmap=a,this.find_elements(),this.container.length>0&&this.build_ad_unit()}return a.prototype.find_elements=function(){return this.container=$$("toolbar-google-adsense"),this.div=$$("ad-container")},a.prototype.build_ad_unit=function(){return this.ad_unit=new $G.adsense.AdUnit(this.div[0],this.ad_unit_options())},a.prototype.ad_unit_options=function(){return{format:$G.adsense.AdFormat.HALF_BANNER,map:this.gmap,visible:!1,publisherId:"pub-1533958540786809"}},a}()}.call(this),function(){MDC.Builder=function(){function a(a,b){this.data=a,this.encrypted=b,this.build_city()}return a.prototype.build_city=function(){return this.city=new MDC.City(this.processed_data())},a.prototype.processed_data=function(){return JSON.parse(this.decrypted_data())},a.prototype.decrypted_data=function(){return this.encrypted?MDC.SegmentCalculator.fanta(this.data):this.data},a}()}.call(this),MDC.Buses={},function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};MDC.Buses.Bus=function(a){function c(a,b,c){this.data=a,this.bus_group=b,this.gmap=c,this.state={},this.hard_state={},this.shifted_state={},this.current_state={},this.build_button(),this.build_routes(),this.build_popup(),this.bind_button(),this.bind_routes(),this.build_state_handler(),this.build_initial_state()}return b(c,a),c.prototype.activated=!1,c.prototype.data=null,c.prototype.build_initial_state=function(){var a;return a={},a.button=this.button.activated,a.popup=!1,a.highlight_ui=!1,a.routes=this.button.activated?2:0,this.set_state(a)},c.prototype.build_state_handler=function(){var a,b,c,d,e,f=this;this.state_handler={},this.state_handler.button=function(a){if(a)return f.button.activate();if(!a)return f.button.deactivate()},this.state_handler.popup=function(a){if(a)return f.popup.show();if(!a)return f.popup.hide()},this.state_handler.highlight_ui=function(a){if(a)return f.button.highlight();if(!a)return f.button.unhighlight()},d=this.routes,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(function(a){return f.state_handler[a.id]=function(b){return a.set_mode(b)}}(a));return e},c.prototype.shift_state=function(a){return this.shifted_state=this.parse_state(a),this.apply_state(this.shifted_state,!0)},c.prototype.unshift_state=function(){return this.shifted_state=!1,this.apply_state(this.state)},c.prototype.set_state=function(a){return this.apply_state(this.parse_state(a))},c.prototype.parse_state=function(a){var b,c,d,e,f;if(a.routes!==void 0){a=_.clone(a),f=this.routes;for(c=0,d=f.length;c<d;c++)b=f[c],a[e=b.id]||(a[e]=a.routes);delete a.routes}return a},c.prototype.apply_state=function(a,b){var c,d,e;b==null&&(b=!1),e=[];for(c in a)d=a[c],this.current_state[c]!==d?(b||(this.state[c]=d),e.push(this.apply_state_value(c,d))):e.push(void 0);return e},c.prototype.apply_state_value=function(a,b){this.current_state[a]=b;if(this.state_handler[a])return this.state_handler[a](b)},c.prototype.is_activated=function(){return this.button.activated},c.prototype.perm=function(){return this.data.perm},c.prototype.build_button=function(){return this.button=new MDC.Buses.BusButton(this.data.id)},c.prototype.build_routes=function(){this.color=MDC.Helpers.Colors.get(),this.routes=[],this.data.encoded_departure_route&&this.routes.push(new MDC.Buses.Route.Builder(this.data.encoded_departure_route,this,!0,this.gmap));if(this.data.encoded_return_route)return this.routes.push(new MDC.Buses.Route.Builder(this.data.encoded_return_route,this,!1,this.gmap))},c.prototype.build_popup=function(){return this.popup=new MDC.Buses.BusPopup(this.data.perm)},c.prototype.bind_button=function(){var a=this;return this.button.add_listener("activated",function(){return a.fire_event("button_activated")}),this.button.add_listener("deactivated",function(){return a.fire_event("button_deactivated")}),this.button.add_listener("mouseover",function(){return a.fire_event("button_hover")}),this.button.add_listener("mouseout",function(){return a.fire_event("button_out")})},c.prototype.bind_routes=function(){var a,b,c,d,e,f=this;d=this.routes,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(function(a){return a.add_listener("mouseover",function(){return f.fire_event("route_hover",a)}),a.add_listener("mouseout",function(){return f.fire_event("route_out")})}(a));return e},c.prototype.find_closest_route=function(a){var b,c,d,e,f,g,h;c=[],h=this.routes;for(f=0,g=h.length;f<g;f++)e=h[f],b=e.direction_to_checkpoints(a),b&&c.push(b);return d=c.sort(function(a,b){return a.walk_distance>b.walk_distance}),d[0]},c}(Utils.Eventable)}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};MDC.Buses.BusButton=function(a){function c(a){this.bus_id=a,this.state=!1,this.find_element(),this.inspect_element(),this.bind_element()}return b(c,a),c.prototype.activated=!1,c.prototype.find_element=function(){return this.element=this.e=$$("bus-"+this.bus_id)},c.prototype.inspect_element=function(){return this.e.hasClass("active")&&(this.activated=!0),this.title=this.e.attr("title"),this.toggled_title=this.e.attr("toggled_title")},c.prototype.bind_element=function(){var a=this;return this.e.click(function(b){return a.activated?a.fire_event("deactivated"):a.fire_event("activated"),b.preventDefault()}),this.e.mouseover(function(){return a.fire_event("mouseover")}),this.e.mouseout(function(){return a.fire_event("mouseout")})},c.prototype.toggle=function(){return this.activated?this.activate():this.deactivate()},c.prototype.activate=function(){if(!this.activated)return this.activated=!0,this.e.addClass("active"),this.set_title()},c.prototype.deactivate=function(){if(this.activated)return this.activated=!1,this.e.removeClass("active"),this.set_title()},c.prototype.highlight=function(){return this.buses_group_element||(this.buses_group_element=$$("buses-groups")),this.buses_group_element.addClass("lowlighted"),this.element.addClass("highlighted")},c.prototype.unhighlight=function(){return this.buses_group_element||(this.buses_group_element=$$("buses-groups")),this.buses_group_element.removeClass("lowlighted"),this.element.removeClass("highlighted")},c.prototype.set_title=function(){return this.e.attr("title",this.activated?this.toggled_title:this.title)},c}(Utils.Eventable)}.call(this),function(){MDC.Buses.BusPopup=function(){function a(a){this.helper=this.get_helper(),this.value=a,this.container=this.helper.container,this.element=this.helper.new_element(a),this.visible=!0}return a.prototype.update_location=function(){if(this.visible)return this.element.css({left:this.helper.mouse_x,top:this.helper.mouse_y})},a.prototype.show=function(){var a=this;return this.element.show(),this.visible=!0,this.helper.call_this_on_mouse_move=function(){return a.update_location()}},a.prototype.hide=function(){return this.element.hide(),this.visible=!1},a.prototype.get_helper=function(){var a;return(a=MDC.Buses.BusPopup).helper||(a.helper=function(){return new MDC.Buses.BusPopup.Helper}())},a}(),MDC.Buses.BusPopup.Helper=function(){function a(){this.mouse_x=0,this.mouse_y=0,this.find_elements(),this.bind_elements()}return a.prototype.call_this_on_mouse_move=function(){},a.prototype.find_elements=function(){return this.container=$$("map-container"),this.template=$$("bus-popup-template"),this.template.removeAttr("id"),this.value_element=this.template.find(".bus-number")},a.prototype.bind_elements=function(){var a=this;return $(window).mousemove(function(b){return a.mouse_x=b.pageX,a.mouse_y=b.pageY,a.call_this_on_mouse_move()})},a.prototype.new_element=function(a){var b;return this.value_element.text(a),b=this.template.clone(),this.container.append(b),b},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};MDC.Buses.Group=function(a){function c(a,b){this.gmap=b,this.build_button(a),this.build_buses(a),this.bind_button()}return b(c,a),c.prototype.build_button=function(a){return this.button=new MDC.Buses.BusButton("group-"+a.id)},c.prototype.build_buses=function(a){var b;return this.buses=function(){var c,d,e,f;e=a.visible_buses,f=[];for(c=0,d=e.length;c<d;c++)b=e[c],f.push(new MDC.Buses.Bus(b,this,this.gmap));return f}.call(this)},c.prototype.bind_button=function(){var a=this;return this.button.add_listener("activated",function(){return a.fire_event("button_activated",a.buses),a.button.activate()}),this.button.add_listener("deactivated",function(){return a.fire_event("button_deactivated",a.buses),a.button.deactivate()}),this.button.add_listener("mouseover",function(){return a.fire_event("button_hover",a.buses)}),this.button.add_listener("mouseout",function(){return a.fire_event("button_out",a.buses)})},c.prototype.deactivate=function(){return this.button.deactivate()},c.prototype.activate=function(){return this.button.activate()},c}(Utils.Eventable)}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};MDC.Buses.Manager=function(a){function c(a,b,c){this.url_helper=b,this.gmap=c,this.active_buses=[],this.find_elements(),this.build_toggle(),this.build_bus_groups(a),this.bind_bus_groups(),this.bind_buses(),this.bind_hide_buses(),this.set_states_actions(),this.update_active_buses(),this.set_hide_buses_state()}return b(c,a),c.prototype.find_elements=function(){return this.buttons_container=$$("buses-groups"),this.hide_buses=$$("hide-buses")},c.prototype.build_toggle=function(){return this.toggle=new MDC.Interface.Toggleable(this.buttons_container,"show_buses_buttons")},c.prototype.build_bus_groups=function(a){var b,c,d,e;this.buses=[],this.bus_groups=[];for(d=0,e=a.length;d<e;d++)c=a[d],b=new MDC.Buses.Group(c,this.gmap),this.bus_groups.push(b),this.buses=this.buses.concat(b.buses);return null},c.prototype.bind_bus_groups=function(){var a,b,c,d,e,f=this;d=this.bus_groups,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],a.add_listener("button_activated",function(a){return f.set_state(a,"activated")}),a.add_listener("button_deactivated",function(a){return f.set_state(a,"deactivated")}),a.add_listener("button_hover",function(a){return f.shift_state(a,"bus_hover")}),e.push(a.add_listener("button_out",function(a){return f.unshift_state(a)}));return e},c.prototype.bind_buses=function(){var a,b,c,d,e,f=this;d=this.buses,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(function(a){return a.add_listener("button_activated",function(){return f.set_state([a],"activated")}),a.add_listener("button_deactivated",function(){return f.set_state([a],"deactivated")}),a.add_listener("button_hover",function(){return f.shift_state([a],"bus_hover")}),a.add_listener("button_out",function(){return f.unshift_state([a])}),a.add_listener("route_hover",function(b){return f.shift_state([[a,b]],"route_hover")}),a.add_listener("route_out",function(){return f.unshift_state([a])})}(a));return e},c.prototype.bind_hide_buses=function(){var a=this;return this.hide_buses.click(function(){return a.set_state(a.buses,"deactivated"),a.deactivate_buses_groups()})},c.prototype.deactivate_buses_groups=function(){var a,b,c,d;d=this.bus_groups;for(b=0,c=d.length;b<c;b++)a=d[b],a.deactivate();return null},c.prototype.find_closest_route=function(a){var b,c,d,e,f;e=this.buses,f=[];for(c=0,d=e.length;c<d;c++)b=e[c],f.push(b.find_closest_route(a));return f},c.prototype.base_states={activated:{button:!0,routes:2},deactivated:{button:!1,routes:0},bus_hover:{routes:3},route_hover:{highlight_ui:!0,popup:!0,route:3},direction_hover:{highlight_ui:!0,popup:!0,route:2},direction_activated:{routes:0,route:1,button:!0},direction_deactivated:{routes:0,button:!1}},c.prototype.set_states_actions=function(){var a=this;return this.states_actions={},this.states_actions.activated=function(){return a.update_active_buses(),a.update_url(),a.set_hide_buses_state()},this.states_actions.deactivated=this.states_actions.direction_activated=function(){return a.update_active_buses(),a.set_hide_buses_state()}},c.prototype.set_state=function(a,b){return this.apply_state(a,b)},c.prototype.shift_state=function(a,b){return this.apply_state(a,b,!0)},c.prototype.unshift_state=function(a){var b,c,d,e;e=[];for(c=0,d=a.length;c<d;c++)b=a[c],e.push(b.unshift_state());return e},c.prototype.apply_state=function(a,b,c){var d,e,f,g,h;c==null&&(c=!1),f=this.base_states[b];for(g=0,h=a.length;g<h;g++)d=a[g],d.constructor===Array?(e=d[1],d=d[0],f[e.id]=f.route,this.push_state(d,f,c),delete f[e.id]):this.push_state(d,f,c);return this.run_state_action(b)},c.prototype.push_state=function(a,b,c){return c?a.shift_state(b):a.set_state(b)},c.prototype.run_state_action=function(a){if(this.states_actions[a])return this.states_actions[a]()},c.prototype.update_active_buses=function(){var a,b,c,d,e;this.active_buses=[],d=this.buses,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],a.is_activated()?e.push(this.active_buses.push(a)):e.push(void 0);return e},c.prototype.update_url=function(){var a,b,c,d,e;b=[],e=this.active_buses;for(c=0,d=e.length;c<d;c++)a=e[c],b.push(a.perm());return this.url_helper.set_buses_city_url(b)},c.prototype.set_hide_buses_state=function(){return this.active_buses.length>0?this.hide_buses.show():this.hide_buses.hide()},c}(Utils.Eventable)}.call(this),MDC.Buses.Route={},function(){}.call(this),function(){}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};MDC.Buses.Route.Builder=function(a){function c(a,b,c,d){this.encoded=a,this.bus=b,this.is_departure=c,this.gmap=d,this.is_return=!c,this.color=this.bus.color,this.id=this.get_id(),this.build_route(),this.bind_route()}return b(c,a),c.prototype.get_id=function(){var a;return(a=MDC.Buses.Route.Builder).id||(a.id=0),(++MDC.Buses.Route.Builder.id).toString()},c.prototype.build_route=function(){return this.decode_points(),this.route=new MapTools.Route(this.gmap,this.points,this.route_options())},c.prototype.bind_route=function(){var a=this;return $G.event.addListener(this.route.poly,"mouseover",function(){return a.fire_event("mouseover")}),$G.event.addListener(this.route.poly,"mouseout",function(){return a.fire_event("mouseout")})},c.prototype.route_options=function(){return{strokeWeight:3,strokeColor:this.color.normal,strokeOpacity:.75,cursor:"default"}},c.prototype.set_mode=function(a){switch(a){case 0:return this.route.hide();case 1:return this.route.set_options({visible:!0,strokeOpacity:.2,strokeWeight:3});case 2:return this.route.set_options({visible:!0,strokeOpacity:.75,strokeWeight:3});case 3:return this.route.set_options({visible:!0,strokeOpacity:1,strokeWeight:6,zIndex:this.constructor.get_z_index()})}},c.prototype.decode_points=function(){return this.points=$G.geometry.encoding.decodePath(this.encoded)},c.prototype.get_shortest_path=function(a,b,c){var d,e,f,g,h,i,j;h=this.route.segments,b||(b=0),b&&(h=h.slice(b)),c?(j=new MDC.Segment(c,h[0].p2),h[0]=j):j=!1,e=b,i=!1;for(f in h)g=h[f],d=g.closest_point(a),i?d.distance<i.distance&&(i=d,e=b+parseInt(f)):i=d;return[i,e]},c.prototype.direction_to_checkpoints=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(this.route.segments.lenght===0)return!1;k=[],i=[],c=!1,d=null,f=0,g=null;for(l=0,m=a.length;l<m;l++)b=a[l],n=this.get_shortest_path(b.point,f,g),j=n[0],f=n[1],k.push(j),g=j.p2,c===!1&&(c=f),d===null&&(d=g);return a.length>1&&(c===f?i=[new MDC.Segment(d,g)]:(i=this.route.segments.slice(c,f+1||9e9),e=new MDC.Segment(d,i[0].p2),h=new MDC.Segment(i.pop().p1,g),i[0]=e,i.push(h))),new MDC.Directions.Direction.Builder(k,i,this.bus,this,this.gmap)},c.prototype.empty_markers=function(){var a,b,c,d;d=this.markers;for(b=0,c=d.length;b<c;b++)a=d[b],a.setMap(null);return this.markers=[]},c.prototype.markers=[],c.prototype.mkmarker=function(a){return a[0]&&(a=new $G.LatLng(a[0],a[1])),this.markers.push(new $G.Marker({map:this.gmap,position:a}))},c.z_index=0,c.get_z_index=function(){return++this.z_index},c}(Utils.Eventable)}.call(this),function(){}.call(this),function(){MDC.Buses.Route.Options=function(){function a(a){this.color=a,this.normal_route_options={strokeWeight:3,strokeColor:this.color,strokeOpacity:.75,zIndex:this.z_index(),cursor:"default"},this.initial_route_options=_.extend(_.clone(this.normal_route_options),{visible:!1}),this.highlight_route_options=_.extend(_.clone(this.normal_route_options),{strokeWeight:6,strokeOpacity:1})}return a.prototype.get_highlight_route_options=function(){return this.highlight_route_options.zIndex=this.z_index(),this.highlight_route_options},a.prototype.z_index=function(){return MDC.Helpers.MapZIndex()},a}()}.call(this),function(){MDC.City=function(){function a(a){this.find_element(),this.build_toggleables(),this.build_map(a),this.build_help_bar(),this.build_url_helper(),this.build_bus_info(),this.build_sell_locations_manager(a),this.build_address_fetcher(a),this.build_buses_manager(a),this.build_directions_manager(),this.build_adsense()}return a.prototype.buses=[],a.prototype.find_element=function(){return this.element=this.e=$$("map")},a.prototype.build_toggleables=function(){return this.social_toggle=new MDC.Interface.Toggleable($$("social"),"show_social"),this.social_toggle=new MDC.Interface.Toggleable($$("toolbar-google-adsense"),"show_adsense")},a.prototype.build_map=function(a){return this.map=new MapTools.Map(this.element,a.viewport),this.gmap=this.map.gmap},a.prototype.build_url_helper=function(){return this.url_helper=new MDC.Interface.UrlHelper(this.buses_manager,this.sell_locations_manager)},a.prototype.build_help_bar=function(){return this.help_bar=new MDC.Interface.HelpBar},a.prototype.build_buses_manager=function(a){return this.buses_manager=new MDC.Buses.Manager(a.bus_groups,this.url_helper,this.gmap),this.buses=this.buses_manager.buses},a.prototype.build_directions_manager=function(){return this.directions_manager=new MDC.Directions.Manager(this,this.buses_manager,this.url_helper)},a.prototype.build_sell_locations_manager=function(a){return this.sell_locations_manager=new MDC.SellLocations.Manager(a.visible_sell_locations,this.url_helper,this.gmap)},a.prototype.build_address_fetcher=function(a){return this.address_fetcher=new MDC.AddressFetcher(a)},a.prototype.build_bus_info=function(){return this.bus_info=new MDC.Interface.BusInfo},a.prototype.build_adsense=function(){return this.adsense=new MDC.Adsense(this.gmap)},a}()}.call(this),MDC.Directions={},MDC.Directions.Checkpoints={},function(){MDC.Directions.Checkpoints.AddressQuery=function(){function a(a){this.city=a}return a.prototype.fetch=function(a,b){var c=this;return this.city.address_fetcher.fetch(a,function(c){return c===-1?b(-1):c?b(new MDC.Directions.Checkpoints.Checkpoint(c,a)):b(!1)})},a}()}.call(this),function(){MDC.Directions.Checkpoints.Autocomplete=function(){function a(a){this.list=a,this.results={}}return a.prototype.query=function(a,b){var c,d,e,f,g,h,i,j,k,l;if(!a)return[];e=new MDC.Directions.Checkpoints.QueryMatcher(a),c=[],g=[];if(b)for(h=0,j=b.length;h<j;h++)f=b[h],e.rematch(f)?f.hard?c.push(f):g.push(f):f.destroy();else{l=this.list;for(i=0,k=l.length;i<k;i++)d=l[i],f=e.match(d),f&&(f.hard?c.push(f):g.push(f))}return c=this.sort_results(c),g=this.sort_results(g),c.concat(g)},a.prototype.match_unique=function(a){var b,c,d,e,f,g,h,i;b=new MDC.Directions.Checkpoints.QueryMatcher(a),h=this.list;for(d=0,f=h.length;d<f;d++){c=h[d];if(b.just_match(c,!0))return c}i=this.list;for(e=0,g=i.length;e<g;e++){c=i[e];if(b.just_match(c,!1))return c}return!1},a.prototype.sort_results=function(a){return a.sort(function(a,b){return a.option[0]-b.option[0]})},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};MDC.Directions.Checkpoints.AutocompleteResult=function(a){function c(a,b,c){this.option=a,this.content=b,this.hard=c,this.build_element(),this.bind_element()}return b(c,a),c.prototype.update=function(a,b){return this.content=a,this.hard=b,this.element.html(this.content)},c.prototype.build_element=function(){return this.element=$("<li>"+this.content+"</li>"),this.bind_element()},c.prototype.bind_element=function(){var a=this;return this.element.mousedown(function(b){return a.fire_event("click"),b.preventDefault()})},c.prototype.append_to=function(a){return this.element.appendTo(a)},c.prototype.highlight=function(){return this.element.addClass("active")},c.prototype.unhighlight=function(){return this.element.removeClass("active")},c.prototype.destroy=function(){return this.element.remove(),this.element.unbind(),this.delete_events()},c}(Utils.Eventable)}.call(this),function(){MDC.Directions.Checkpoints.Checkpoint=function(){function a(a){this.name=a.name,this.perm=a.perm,this.latlng=a.latlng,this.value=a.value,this.autocomplete=a.autocomplete,this.value||(this.value=a.point),this.parse_value_latlng(),this.perm&&(this.perm=decodeURI(this.perm)),!this.perm&&this.name&&this.value?this.perm_from_name():!this.name&&!this.perm&&this.value?(this.perm_from_value(),this.name_from_value()):!this.name&&!this.value&&this.perm?this.value_from_perm()?this.name_from_value():(this.name_from_perm(),this.value_from_autocomplete()):!this.perm&&!this.value&&this.name&&(this.value_from_name()?this.perm_from_value():(this.perm_from_name(),this.value_from_autocomplete()))}return a.prototype.parse_value_latlng=function(){this.value?this.latlng=$LatLng(this.value):this.latlng&&(this.value=[this.latlng.lat(),this.latlng.lng()]);if(this.value)return this.set_value_attributes()},a.prototype.set_value_attributes=function(){return this.lat=this.value[0],this.lng=this.value[1],this.point=this.value},a.prototype.set_latlng=function(a){return this.latlng=a,this.parse_value_latlng()},a.prototype.fetch=function(a,b){var c=this;return a.fetch(this.name,function(a){return a===-1?b(-1):a?(c.set_latlng(a),b(!0)):b(!1)})},a.prototype.fetch_if_not_value=function(a,b){return this.value?b(!0):this.fetch(a,b)},a.prototype.perm_from_value=function(){return this.perm=this.compress_points(this.value)},a.prototype.name_from_value=function(){return this.name=""+parseInt(this.value[0]*1e3)/1e3+", "+parseInt(this.value[1]*1e3)/1e3},a.prototype.perm_from_name=function(){return this.perm=encodeURI(this.name.replace(/\s/g,"-"))},a.prototype.value_from_perm=function(){return this.value=this.decompress_points(this.perm.replace(/\s/g,"")),this.value&&this.value[0]&&this.value[1]?(this.parse_value_latlng(),!0):(this.value=null,!1)},a.prototype.value_from_name=function(){var a;return a=this.name.split(","),this.value=[],this.value[0]=parseFloat(a[0]),this.value[1]=parseFloat(a[1]),this.value[0]&&this.value[1]?(this.parse_value_latlng(),!0):(this.value=null,!1)},a.prototype.name_from_perm=function(){return this.name=this.perm.replace("-"," ")},a.prototype.value_from_autocomplete=
function(){var a;if(this.autocomplete){a=this.autocomplete.match_unique(this.name);if(a)return this.name=a[0],this.value=a[1],this.parse_value_latlng()}},a.prototype.compress_points=function(a,b){var c,d,e,f,g;b==null&&(b=5),c=[],b=Math.pow(10,b);for(f=0,g=a.length;f<g;f++)d=a[f],d=parseInt(d*b),d>0?e="+":(e="-",d=-d),c.push(e),c.push(d.toString());return c.join("")},a.prototype.decompress_points=function(a,b){var c;b==null&&(b=5),b=Math.pow(10,b),c=a.match(/^([+-][0-9]+)([+-][0-9]+)$/);if(c){c.shift();if(c.length===2)return c[0]=parseInt(c[0])/b,c[1]=parseInt(c[1])/b,c}},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};MDC.Directions.Checkpoints.Input=function(a){function c(a,b,c,d,e){this.element=a,this.marker=b,this.autocomplete=c,this.address_fetcher=d,this.latlng_convertor=e,this.find_elements(),this.build_dropdown(),this.bind_elements()}return b(c,a),c.prototype.new_checkpoint=function(a){return new MDC.Directions.Checkpoints.Checkpoint(a)},c.prototype.fire_empty=function(){return this.fire_event("empty")},c.prototype.fire_change=function(){return this.fire_event("change",this.checkpoint)},c.prototype.empty=function(){return this.checkpoint=null,this.marker.hide(),this.dropdown.empty(),this.input.val("")},c.prototype.focus=function(){return this.input.focus()},c.prototype.focus_next=function(){return this.fire_event("focus_next")},c.prototype.match_dropdown=function(){return this.dropdown.match(this.input.val())},c.prototype.only_with_fetched_checkpoint_value=function(a,b){var c=this;return a==null&&(a=!1),this.checkpoint.fetch_if_not_value(this.address_fetcher,function(d){if(d===!0)return b(!0);c.handle_fetch_fail(d);if(a)return b(!1)})},c.prototype.handle_fetch_fail=function(a){if(a===!1)return this.service_unavailable.show().delay(1e3).fadeOut();if(a===-1)return this.not_found.show().delay(1e3).fadeOut()},c.prototype.find_elements=function(){return this.input=this.element.find("input"),this.cross=this.element.find(".empty-input"),this.dropdown_element=this.element.find(".checkpoint-autocomplete"),this.service_unavailable=this.element.find(".checkpoint-service-unavailable"),this.not_found=this.element.find(".checkpoint-not-found")},c.prototype.build_dropdown=function(){this.dropdown=new MDC.Directions.Checkpoints.InputDropdown(this.dropdown_element,this.autocomplete);if(this.input.is(":focus"))return this.dropdown.show()},c.prototype.bind_elements=function(){var a=this;return this.dropdown.add_listener("select",function(b){return a.set_from_dropdown(b),a.match_dropdown()}),this.input.keydown(function(b){if(a.dropdown.command(b.keyCode))return b.preventDefault();if(b.keyCode===13)return a.focus_next()}),this.input.keyup(function(b){return a.match_dropdown()}),this.input.blur(function(){return a.dropdown.hide()}),this.input.focus(function(){return a.dropdown.show()}),this.input.change(function(){return a.set_from_input(a.input.val())}),this.cross.click(function(){return a.empty(),a.focus(),a.fire_empty()}),this.marker.add_listener("middleclick",function(){return a.fire_event("reverse")}),this.marker.add_listener("rightclick",function(){return a.empty(),a.fire_empty()}),this.marker.add_listener("move",function(b){return a.fire_event("marker_dragend"),a.set_from_marker(b)})},c.prototype.set_from_dropdown=function(a){return this.checkpoint=this.new_checkpoint({name:a[0],point:a[1]}),this.set_marker(),this.set_input(),this.fire_change(),this.focus_next()},c.prototype.set_from_input=function(a){var b=this;return a?(this.checkpoint=this.new_checkpoint({name:a}),this.only_with_fetched_checkpoint_value(!1,function(){return b.set_marker(),b.fire_change()})):(this.empty(),this.fire_empty())},c.prototype.set_from_marker=function(a){return this.checkpoint=this.new_checkpoint({latlng:a}),this.set_input(),this.fire_change()},c.prototype.set_from_map=function(a){return this.checkpoint=this.new_checkpoint({latlng:a}),this.set_input(),this.set_marker()},c.prototype.set_from_geolocation=function(a){return this.set_from_map(a)},c.prototype.set_from_manager=function(a){return a?(this.checkpoint=a,this.set_input(),this.set_marker()):this.empty()},c.prototype.set_from_url=function(a,b){var c=this;return this.checkpoint=this.new_checkpoint({perm:a,autocomplete:this.autocomplete}),this.set_input(),this.only_with_fetched_checkpoint_value(!0,function(a){return a?(c.set_marker(),b(!0)):b(!1)})},c.prototype.set_marker=function(){return this.marker.show(this.checkpoint.latlng)},c.prototype.set_input=function(){return this.input.val(this.checkpoint.name)},c}(Utils.Eventable)}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};MDC.Directions.Checkpoints.InputDropdown=function(a){function c(a,b){this.element=a,this.autocomplete=b,this.visible=!1,this.results=[],this.active=null,this.last_query=""}return b(c,a),c.prototype.command=function(a){if(this.results.length>0){if(a===40)return this.move_down(),!0;if(a===38)return this.move_up(),!0;if(a===13||a===9)return this.select()}return!1},c.prototype.match=function(a){if(a!==this.last_query)return this.last_query&&a.length>this.last_query.length?this.results=this.autocomplete.query(a,this.results):(this.empty(),this.results=this.autocomplete.query(a),this.fill()),this.last_query=a},c.prototype.fill=function(){var a,b,c,d,e;d=this.results,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],this.bind_result(a),e.push(a.append_to(this.element));return e},c.prototype.bind_result=function(a){var b=this;return a.add_listener("click",function(){return b.active=a,b.select()})},c.prototype.move_down=function(){return this.move(1)},c.prototype.move_up=function(){return this.move(-1)},c.prototype.move=function(a){var b,c;this.active&&this.active.unhighlight(),b=this.results.indexOf(this.active),b+=a,c=this.results.length-1,b!==-1&&(b>c?b=-1:b===-2&&(b=c)),this.active=this.results[b];if(this.active)return this.active.highlight()},c.prototype.select=function(){return this.active?(this.fire_event("select",this.active.option),!0):!1},c.prototype.hide=function(){return this.element.hide(),this.visible=!1},c.prototype.show=function(){return this.element.show(),this.visible=!0},c.prototype.empty=function(){var a,b,c,d,e;this.active=null,this.element.empty(),this.last_query="",d=this.results,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(a.destroy());return e},c}(Utils.Eventable)}.call(this),function(){var a,b=Object.prototype.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};MDC.Directions.Checkpoints.Manager=function(b){function d(a,b,c){this.city=a,this.autocomplete_list=b,this.url_helper=c,this.fill_autocomplete_checkpoints(),this.gmap=this.city.gmap,this.checkpoints=[],this.inputs=[],this.geolocation=null,this.last_geolocation=null,this.url_origin=null,this.url_destin=null,this.disregard_click=!1,this.params=this.url_helper.params,this.build_autocomplete(),this.address_fetcher=this.city.address_fetcher,this.build_inputs(),this.find_buttons(),this.bind_buttons(),this.bind_map_events()}return c(d,b),d.prototype.fill_autocomplete_checkpoints=function(){return this.autocomplete_list=[]},d.prototype.build_autocomplete=function(){return this.autocomplete=new MDC.Directions.Checkpoints.Autocomplete(this.autocomplete_list)},d.prototype.build_inputs=function(){var a=this;return this.inputs_elements=$(".checkpoint-input"),this.inputs_elements.each(function(b,c){var d,e;return e=new MDC.Directions.Checkpoints.Marker(a.gmap,b),d=new MDC.Directions.Checkpoints.Input($(c),e,a.autocomplete,a.address_fetcher),a.inputs.push(d),a.checkpoints.push(null),a.bind_input(b,d)})},d.prototype.find_buttons=function(){return this.reverse_button=$$("switch-checkpoints"),this.current_position_button=$$("current-position-checkpoint")},d.prototype.bind_buttons=function(){var a=this;return this.reverse_button.click(function(){return a.reverse_checkpoints(),a.fire_change(),a.write_url()}),this.current_position_button.click(function(){return a.read_geolocation(function(b){var c;if(b)return c=a.checkpoints[0]?a.checkpoints[1]?0:1:0,a.inputs[c].set_from_geolocation($LatLng(a.geolocation)),a.grab_checkpoint(c),a.fire_change(),a.write_url()})})},d.prototype.bind_map_events=function(){var a=this;return $G.event.addListener(this.gmap,"click",function(b){if(!a.disregard_click)return a.insert_checkpoint(b.latLng),a.fire_change(),a.write_url()})},d.prototype.bind_input=function(a,b){var c=this;return b.add_listener("marker_dragend",function(){return c.disregard_click=!0,setTimeout(function(){return c.disregard_click=!1},200)}),b.add_listener("change",function(b){return c.checkpoints[a]=b,c.fire_change(),c.write_url()}),b.add_listener("reverse",function(){return c.reverse_checkpoints(),c.fire_change(),c.write_url()}),b.add_listener("empty",function(b){return c.checkpoints[a]=null,c.fire_change(),c.write_url()}),b.add_listener("focus_next",function(){var a;return a=c.inputs.indexOf(b)+1,a>=c.inputs.length&&(a=0),c.inputs[a].focus()})},d.prototype.insert_checkpoint=function(a){var b,c,d,e;e=this.inputs;for(b=0,d=e.length;b<d;b++){c=e[b];if(!c.checkpoint){c.set_from_map(a),this.checkpoints[b]=c.checkpoint;return}}return this.shift_checkpoints(a)},d.prototype.shift_checkpoints=function(a){var b,c,d,e,f;b=this.new_checkpoint({latlng:a}),this.checkpoints.shift(),this.checkpoints.push(b),f=this.inputs;for(c=0,e=f.length;c<e;c++)d=f[c],d.set_from_manager(this.checkpoints[c]);return null},d.prototype.reverse_checkpoints=function(){var a,b,c,d,e;this.checkpoints=this.checkpoints.reverse(),d=this.inputs,e=[];for(a=0,c=d.length;a<c;a++)b=d[a],e.push(b.set_from_manager(this.checkpoints[a]));return e},d.prototype.write_url=function(){var a,b;b=a=null,this.checkpoints[0]&&(b=this.checkpoints[0].perm),this.checkpoints[1]&&(a=this.checkpoints[1].perm);if(b||a)return this.url_helper.set_directions_city_url(b,a)},d.prototype.initial_check=function(){if(!this.params.buses&&!this.params.sell_locations)return this.set_initial_checkpoints()},d.prototype.set_initial_checkpoints=function(){var b,c,d,e,f,g,h=this;b=new a(2,function(){if(h.compact_checkpoints().length>0)return h.fire_change()}),g=[this.params.origin,this.params.destination],e=function(a){return d?h.inputs[a].set_from_url(d,function(c){return c&&h.grab_checkpoint(a),b.finish()}):a===0?h.read_geolocation(function(c){var d;return d=null,c&&h.geolocation_changed()?d=$LatLng(h.geolocation):h.initial_checkpoint()&&(d=$LatLng(h.initial_checkpoint())),d&&(h.inputs[a].set_from_geolocation(d),h.grab_checkpoint(a)),b.finish()}):b.finish()};for(c=0,f=g.length;c<f;c++)d=g[c],e(c);return null},d.prototype.geolocation_changed=function(){return this.last_geolocation&&this.geolocation?this.last_geolocation[0]!==this.geolocation[0]||this.last_geolocation[1]!==this.geolocation[1]:this.geolocation!==this.last_geolocation},d.prototype.initial_checkpoint=function(){return MDC.SETTINGS.read.initial_checkpoint},d.prototype.read_geolocation=function(a){var b=this;return navigator.geolocation?navigator.geolocation.getCurrentPosition(function(c){var d,e;d=c.coords.latitude,e=c.coords.longitude;if(d&&e)return b.geolocation=[d,e],b.last_geolocation=MDC.SETTINGS.read.last_geolocation,MDC.SETTINGS.set("last_geolocation",[d,e]),a(!0)},function(){return a(!1)}):a(!1)},d.prototype.grab_checkpoint=function(a){return this.checkpoints[a]=this.inputs[a].checkpoint},d.prototype.new_checkpoint=function(a){return new MDC.Directions.Checkpoints.Checkpoint(a)},d.prototype.fire_change=function(){return this.checkpoints[0]&&MDC.SETTINGS.set("initial_checkpoint",this.checkpoints[0].point),this.fire_event("change",this.compact_checkpoints())},d.prototype.compact_checkpoints=function(){return _.compact(this.checkpoints)},d}(Utils.Eventable),a=function(){function a(a,b){this.ammount=a,this.callback=b}return a.prototype.finish=function(){--this.ammount;if(this.ammount===0)return this.callback()},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};MDC.Directions.Checkpoints.Marker=function(a){function c(a,b){this.gmap=a,this.number=b,++this.number}return b(c,a),c.prototype.checkpoint=null,c.prototype.marker=null,c.prototype.visible=!1,c.prototype.construct=function(){if(!this.marker)return this.build_marker(),this.bind_marker()},c.prototype.build_marker=function(){return this.marker=new $G.Marker(this.marker_options())},c.prototype.marker_options=function(){return{map:this.gmap,position:this.latlng,draggable:!0,flat:!0,icon:this.get_icon(),shape:MDC.Helpers.NumberIcons.shape,raiseOnDrag:!1,visible:!1}},c.prototype.bind_marker=function(){var a=this;return $G.event.addListener(this.marker,"dragend",function(b){return a.latlng=b.latLng,a.fire_event("move",a.latlng)}),$G.event.addListener(this.marker,"rightclick",function(b){return a.fire_event("rightclick")}),$G.event.addListener(this.marker,"dblclick",function(b){return a.fire_event("middleclick")}),$G.event.addListener(this.marker,"mouseup",function(b){var c,d,e;e=[];for(c in b)d=b[c],d&&d.button?d.button===1?e.push(a.fire_event("middleclick")):e.push(void 0):e.push(void 0);return e})},c.prototype.set_latlng=function(a){return this.latlng=a,this.update_marker_position()},c.prototype.update_marker_position=function(){return this.construct(),this.marker.setPosition(this.latlng),this.show()},c.prototype.show=function(a){return a?this.set_latlng(a):this.construct(),this.marker.setVisible(!0),this.visible=!0},c.prototype.hide=function(){return this.marker&&this.marker.setVisible(!1),this.visible=!1},c.prototype.get_icon=function(){return MDC.Helpers.NumberIcons.get(this.number)},c}(Utils.Eventable)}.call(this),function(){MDC.Directions.Checkpoints.QueryMatcher=function(){function a(a){this.query=a,this.query=this.sanitize(this.query),this.string=this.query,this.length=this.query.length,this.query,this.hard=new RegExp("^"+a,"i"),this.soft=new RegExp(a,"i")}return a.prototype.sanitize=function(a){return a.replace(/[^a-z 0-9]/,"")},a.prototype.match=function(a){return a[0].match(this.hard)?this.make_result(a,!0):a[0].match(this.soft)?this.make_result(a,!1):!1},a.prototype.rematch=function(a){return a.option[0].match(this.hard)?(a.update(this.highlight(a.option),!0),!0):a.option[0].match(this.soft)?(a.update(this.highlight(a.option),!1),!0):!1},a.prototype.just_match=function(a,b){return b==null&&(b=!0),b?a[0].match(this.hard):a[0].match(this.soft)},a.prototype.make_result=function(a,b){return new MDC.Directions.Checkpoints.AutocompleteResult(a,this.highlight(a),b)},a.prototype.highlight=function(a){var b,c,d;return c=a[0],d=c.search(this.soft),b=d+this.length,c=c.slice(0,d)+"<b>"+c.slice(d,b)+"</b>"+c.slice(b)},a}()}.call(this),function(){}.call(this),MDC.Directions.Controls={},function(){MDC.Directions.Controls.Builder=function(){function a(){this.find_elements(),this.create_toggle(),this.create_slider(),this.bind_slider()}return a.prototype.find_elements=function(){return this.container=$$("buses-directions")},a.prototype.create_toggle=function(){return this.toggle=new MDC.Interface.Toggleable(this.container,"show_directions")},a.prototype.create_slider=function(){return this.slider=new MDC.Directions.Controls.Slider.Manager(MDC.SETTINGS.read.max_walking_distance)},a.prototype.bind_slider=function(){var a=this;return this.slider.add_listener("change",function(a){return MDC.SETTINGS.set("max_walking_distance",a)})},a}()}.call(this),function(){MDC.Directions.Controls.Slider={}}.call(this),function(){MDC.Directions.Controls.Slider.Convertor=function(){function a(a,b,c,d,e,f){this.default_value=a,this.min=b,this.max=c,this.default_min_bound=d,this.default_max_bound=e,this.element=f,this.update_bounds(),this.set_min_max(this.min,this.max)}return a.prototype.position=0,a.prototype.set_value=function(a){return a<this.min?a=this.min:a>this.max&&(a=this.max),a!==this.value?(this.value=a,this.recalculate_position(),!0):!1},a.prototype.recalculate_value=function(){return this.value=parseInt((this.position-this.min_bound)/this.bound_range*this.range/10)*10+this.min},a.prototype.set_position=function(a){return a<this.min_bound?a=this.min_bound:a>this.max_bound&&(a=this.max_bound),a!==this.position?(this.position=a,this.recalculate_value(),this.default_value=this.value,!0):!1},a.prototype.recalculate_position=function(){return this.update_bounds(),this.position=parseInt((this.value-this.min)/this.range*this.bound_range+this.min_bound)},a.prototype.update_bounds=function(){var a;return a=this.element.width(),this.min_bound=this.default_min_bound,this.max_bound=this.default_max_bound,this.max_bound>a&&(this.max_bound-=a),this.bound_range=this.max_bound-this.min_bound,this.default_bound_range=this.default_max_bound-this.default_min_bound},a.prototype.set_min_max=function(a,b){this.min=parseInt((a+10)/10)*10,this.max=parseInt((b+20)/10)*10,this.range=this.max-this.min;if(!this.set_value(this.default_value))return this.recalculate_position()},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};MDC.Directions.Controls.Slider.Element=function(a){function c(a){this.options=a,this.o=this.options,this.element=this.o.element,this.find_elements(),this.bind_element(),this.build_convertor(),this.global_offset=this.o.global_offset,this.update_value(),this.change_element_position()}return b(c,a),c.prototype.dragging=!1,c.prototype.dragging_position=0,c.prototype.rebuild=function(a){return this.o=this.options=_.extend(this.options,a),this.global_offset=this.o.global_offset,this.build_convertor(),this.update_value(),this.change_element_position()},c.prototype.build_convertor=function(){return this.convertor=new MDC.Directions.Controls.Slider.Convertor(this.o.value,this.o.min,this.o.max,this.o.min_bound,this.o.max_bound,this.element)},c.prototype.find_elements=function(){return this.window=$(window),this.value_element=this.element.find(".slider-number")},c.prototype.bind_element=function(){var a=this;return this.element.mousedown(function(b){return a.start_dragging(b)})},c.prototype.start_dragging=function(a){var b=this;this.dragging=!0,this.dragging_position=a.offsetX||a.pageX-this.element.offset().left,this.window.one("mouseup",function(){return b.stop_dragging()}),this.window.mousemove(function(a){b.dragging_move(a),b.dragging||b.window.unbind(a)})},c.prototype.dragging_move=function(a){var b;b=a.pageX-this.global_offset-this.dragging_position;if(this.set_element_position(b))return this.fire_event("change",this.convertor.value)},c.prototype.stop_dragging=function(){this.dragging=!1},c.prototype.set_element_position=function(a){var b;return b=this.convertor.value,this.change_element_position(a),this.convertor.value!==b?(this.update_value(),!0):!1},c.prototype.change_element_position=function(a){this.convertor.update_bounds();if(!a&&a!==0)return this.convertor.recalculate_position(),this.update_element_position();this.convertor.update_bounds();if(this.convertor.set_position(a))return this.update_element_position()},c.prototype.update_element_position=function(){return this.element.css({left:this.convertor.position})},c.prototype.set_value=function(a){return this.change_value(a),this.update_element_position()},c.prototype.change_value=function(a){return!a&&a!==0||this.convertor.set_value(a)?(this.update_value(),!0):!1},c.prototype.update_value=function(){var a;return a=this.value_element.text().length,this.value_element.text(this.convertor.value)},c.prototype.set_min_max=function(a,b){},c}(Utils.Eventable)}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};MDC.Directions.Controls.Slider.Manager=function(a){function c(a){this.initial_value=a,this.min=MDC.CONFIG.max_walking_distance_min,this.max=MDC.CONFIG.max_walking_distance_max,this.find_elements(),this.build_slider(),this.bind_slider(),this.bind_window()}return b(c,a),c.prototype.find_elements=function(){return this.container=$$("buses-directions-slider"),this.rail=this.container.find(".slider-rail"),this.slider_e=this.container.find(".slider"),this.window=$(window)},c.prototype.build_slider=function(a){return this.slider=new MDC.Directions.Controls.Slider.Element(this.slider_options())},c.prototype.slider_options=function(){return{element:this.slider_e,value:this.initial_value,min:this.min,max:this.max,min_bound:0,max_bound:this.container.width(),global_offset:this.container.offset().left+0}},c.prototype.bind_slider=function(){var a=this;return this.slider.add_listener("change",function(b){return a.fire_event("change",b)})},c.prototype.bind_window=function(){var a=this;return this.window.resize(function(){return a.slider.rebuild(a.slider_options())})},c.prototype.set_min_max=function(a,b){return this.slider.set_min_max(a,b)},c}(Utils.Eventable)}.call(this),MDC.Directions.Direction={},function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};MDC.Directions.Direction.Builder=function(a){function c(a,b,c,d,e){this.walk_segments=a,this.route_segments=b,this.bus=c,this.bus_route=d,this.gmap=e,this.buses=[this.bus],this.bus_routes=[this.bus_route],this.buses_routes=[[this.bus,this.bus_route]],this.color=this.bus.color,this.buses_names=[this.bus.data.name],this.bus_name=this.bus.data.name,this.build_route(),this.build_walk(),this.set_distances(),this.build_info_box()}return b(c,a),c.prototype.gmap=null,c.prototype.walk_segments=null,c.prototype.route_segments=null,c.prototype.walk_distance=0,c.prototype.walk_distances=[],c.prototype.route_distance=0,c.prototype.made_visible=!1,c.prototype.bus=null,c.prototype.buses=null,c.prototype.color=null,c.prototype.buses_names=null,c.prototype.bus_name=null,c.prototype.route=null,c.prototype.walk=null,c.prototype.info_box=null,c.prototype.visible=!1,c.prototype.construct_for_visible=function(){return this.made_visible=!0,this.bind_elements()},c.prototype.build_route=function(){return this.route=new MDC.Directions.Direction.Route(this.route_segments,this.color,this.gmap)},c.prototype.build_walk=function(){return this.walk=new MDC.Directions.Direction.Walk(this.walk_segments,this.buses,this.gmap)},c.prototype.set_distances=function(){return this.walk_distance=this.walk.distance,this.walk_distances=this.walk.distances,this.route_distance=this.route.distance},c.prototype.build_info_box=function(){return this.info_box=new MDC.Directions.Direction.InfoBox(this.walk_distances,this.route_distance,this.buses_names)},c.prototype.bind_elements=function(){var a=this;return this.route.add_listener("mouseover",function(){return a.highlight(),a.fire_event("mouseover"),a.fire_event("route_mouseover")}),this.route.add_listener("mouseout",function(){return a.unhighlight(),a.fire_event("mouseout"),a.fire_event("route_mouseout")}),this.walk.add_listener("mouseover",function(){return a.highlight(),a.fire_event("mouseover"),a.fire_event("walk_mouseover")}),this.walk.add_listener("mouseout",function(){return a.unhighlight(),a.fire_event("mouseout"),a.fire_event("walk_mouseout")}),this.info_box.add_listener("mouseover",function(){return a.highlight(),a.fire_event("mouseover"),a.fire_event("info_box_mouseover")}),this.info_box.add_listener("mouseout",function(){return a.unhighlight(),a.fire_event("mouseout"),a.fire_event("info_box_mouseout")})},c.prototype.show=function(){if(!this.visible)return this.made_visible||this.construct_for_visible(),this.route.show(),this.walk.show(),this.info_box.show(),this.visible=!0},c.prototype.show_buses=function(){var a;return a={routes:0,button:!0},a[this.bus_route.id]=1,this.bus.set_state(a)},c.prototype.hide=function(){if(this.visible)return this.route.hide(),this.walk.hide(),this.info_box.hide(),this.visible=!1},c.prototype.hide_buses=function(){var a;return a={routes:0,button:!1},this.bus.set_state(a)},c.prototype.highlight=function(){return this.route.highlight()},c.prototype.shift_buses=function(){var a;return a={popup:!0},a[this.bus_route.id]=2,this.bus.shift_state(a)},c.prototype.unhighlight=function(){return this.route.unhighlight()},c.prototype.unshift_buses=function(){return this.bus.unshift_state()},c.prototype.append_info_box_to=function(a){return this.info_box.append_to(a)},c.prototype.remove_info_box=function(){return this.info_box.remove()},c.prototype.destroy=function(){return this.route.destroy(),this.walk.destroy(),this.info_box.destroy()},c}(Utils.Eventable)}.call(this),function(){MDC.Directions.Direction.BusesIconsOverlay=function(){function a(a,b,c,d){this.bus_data=a,this.color=b,this.latlng_=c,this.map_=d,this.div_=null,this.setMap(d)}return a.prototype=new $G.OverlayView,a.prototype.onAdd=function(){var a,b,c,d;return a=document.createElement("div"),a.style.zIndex="99999",a.className="bus-icon",b=document.createElement("div"),b.style.backgroundColor=this.color.normal,b.style.borderColor=this.color.dark,b.innerHTML=this.bus_data.name,this.bus_data.division&&(d=document.createElement("span"),d.innerHTML=this.bus_data.division,b.appendChild(d)),a.appendChild(b),this.div_=a,c=this.getPanes(),c.overlayMouseTarget.appendChild(a),this.bind()},a.prototype.bind=function(){var a=this;return $G.event.addDomListener(this.div_,"mouseover",function(){return google.maps.event.trigger(a,"mouseover")}),$G.event.addDomListener(this.div_,"mouseout",function(){return google.maps.event.trigger(a,"mouseout")})},a.prototype.draw=function(){var a,b,c;return b=this.getProjection(),c=b.fromLatLngToDivPixel(this.latlng_),a=this.div_,a.style.left=c.x+"px",a.style.top=c.y+"px"},a.prototype.onRemove=function(){return this.div_.parentNode.removeChild(this.div_),this.div_=null},a.prototype.hide=function(){if(this.div_)return this.div_.style.visibility="hidden"},a.prototype.show=function(){if(this.div_)return this.div_.style.visibility="visible"},a.prototype.toggle=function(){if(this.div_)return this.div_.style.visibility==="hidden"?this.show():this.hide()},a.prototype.toggleDOM=function(){return this.getMap()?this.setMap(null):this.setMap(this.map_)},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};MDC.Directions.Direction.InfoBox=function(a){function c(a,b,c){this.walk_distances=a,this.route_distance=b,this.buses_names=c}return b(c,a),c.prototype.element=null,c.prototype.construct_element=function(){return this.build_element(),this.bind_element()},c.prototype.build_element=function(){return this.element=this.get_template().clone(this.buses_names,this.walk_distances,this.route_distance)},c.prototype.bind_element=function(){var a=this;return this.element.mouseover(function(){return a.fire_event("mouseover")}),this.element.mouseout(function(){return a.fire_event("mouseout")})},c.prototype.append_to=function(a){return this.element||this.construct_element(),a.append(this.element)},c.prototype.show=function(){return this.element||this.construct_element(),this.element.show()},c.prototype.hide=function(){return this.element.hide()},c.prototype.destroy=function(){if(this.element)return this.element.remove(),this.element.unbind()},c.prototype.remove=function(){if(this.element)return this.element.remove()},c.prototype.get_template=function(){var a;return(a=MDC.Directions.Direction.InfoBox).template||(a.template=function(){return new MDC.Directions.Direction.InfoBoxTemplate}())},c}(Utils.Eventable)}.call(this),function(){MDC.Directions.Direction.InfoBoxTemplate=function(){function a(){this.find_elements(),this.parse_elements()}return a.prototype.find_elements=function(){return this.element=$$("bus-direction-template"),this.bus_name=this.element.find(".bus-name-value"),this.walk_distance=this.element.find(".walking-distance"),this.route_distance=this.element.find(".route-distance")},a.prototype.parse_elements=function(){return this.element.removeAttr("id"),this.element.remove(),this.walk_distance_unit="m",this.route_distance_unit="km",this.walk_title_start=this.walk_distance.attr("data-title-start"),this.walk_title_middle=this.walk_distance.attr("data-title-middle"),this.walk_title_end=this.walk_distance.attr("data-title-end")},a.prototype.generate_walk_distances=function(a){var b,c,d,e,f;c=a.length-1,f=[];for(b=0,e=a.length;b<e;b++)d=a[b],b===0?f.push(this.generate_walk_distance(d,this.walk_title_start)):b===c?f.push(this.generate_walk_distance(d,this.walk_title_end)):f.push(this.generate_walk_distance(d,this.walk_title_middle));return f},a.prototype.generate_walk_distance=function(a,b){return"<span title='"+b+"'>"+a+this.walk_distance_unit+"</span>"},a.prototype.set_values=function(a,b,c){return c=parseInt(c/1e3),b=this.generate_walk_distances(b),this.bus_name[0].innerHTML=a.join("/"),this.walk_distance[0].innerHTML=b.join("/"),this.route_distance[0].innerHTML=c+this.route_distance_unit},a.prototype.clone=function(a,b,c){return this.set_values(a,b,c),this.element.clone()},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};MDC.Directions.Direction.Route=function(a){function c(a,b,c){this.segments=a,this.color=b,this.gmap=c,this.calculate_values()}return b(c,a),c.prototype.polyline=null,c.prototype.calculate_values=function(){var a,b,c,d;this.distance=0,d=this.segments;for(b=0,c=d.length;b<c;b++)a=d[b],this.distance+=a.distance_in_meters();return this.distance=parseInt(this.distance),null},c.prototype.create_polyline=function(){if(this.segments.length>0)return this.polyline=new $G.Polyline(this.polyline_options())},c.prototype.polyline_options=function(){return{map:this.gmap,path:this.polyline_path(),strokeWeight:3,strokeColor:this.color.normal,strokeOpacity:.75,cursor:"default",visible:!1,zIndex:this.constructor.get_z_index()}},c.prototype.polyline_path=function(){var a,b,c,d;this.path=[],d=this.segments;for(b=0,c=d.length;b<c;b++)a=d[b],this.path.push(a.latlng1);return this.path.push(a.latlng2),this.path},c.prototype.bind_polyline=function(){var a=this;if(this.polyline)return $G.event.addListener(this.polyline,"mouseover",function(){return a.fire_event("mouseover")}),$G.event.addListener(this.polyline,"mouseout",function(){return a.fire_event("mouseout")})},c.prototype.show=function(){this.polyline||(this.create_polyline(),this.bind_polyline());if(this.polyline)return this.polyline.setVisible(!0)},c.prototype.hide=function(){if(this.polyline)return this.polyline.setVisible(!1)},c.prototype.highlight=function(){if(this.polyline)return this.polyline.setOptions({strokeWeight:6,strokeOpacity:1,zIndex:this.constructor.get_z_index()})},c.prototype.unhighlight=function(){if(this.polyline)return this.polyline.setOptions({strokeWeight:3,strokeOpacity:.75})},c.prototype.destroy=function(){if(this.polyline)return this.polyline.setMap(null),$G.event.clearInstanceListeners(this.polyline)},c.z_index=0,c.get_z_index=function(){return++this.z_index},c}(Utils.Eventable)}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};MDC.Directions.Direction.Walk=function(a){function c(a,b,c){this.segments=a,this.buses=b,this.gmap=c,this.bus=this.buses[0],this.color=this.bus.color,this.calculate_values()}return b(c,a),c.prototype.construct_elements=function(){return this.build_buses_icons(),this.bind_buses_icons(),this.build_lines()},c.prototype.calculate_values=function(){var a,b,c,d,e;this.distance=0,this.distances=[],e=this.segments;for(c=0,d=e.length;c<d;c++)b=e[c],a=b.distance_in_meters(),this.distance+=a,this.distances.push(parseInt(a));return this.distance=parseInt(this.distance),null},c.prototype.build_buses_icons=function(){var a,b,c,d;this.buses_icons=[],d=this.segments;for(b=0,c=d.length;b<c;b++)a=d[b],this.buses_icons.push(new MDC.Directions.Direction.WalkBusIcon
(a.middle_latlng(),this.buses,this.gmap));return null},c.prototype.bind_buses_icons=function(){var a,b,c,d;d=this.buses_icons;for(b=0,c=d.length;b<c;b++)a=d[b],this.inherit_listener(a,"mouseover"),this.inherit_listener(a,"mouseout");return null},c.prototype.build_lines=function(){var a,b,c,d,e;this.lines=[],d=this.segments,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(this.lines.push(new MDC.Directions.Direction.WalkLine(a,this.color,this.gmap)));return e},c.prototype.show=function(){var a,b,c,d,e,f,g,h;this.lines||this.construct_elements(),g=this.lines;for(c=0,e=g.length;c<e;c++)b=g[c],b.show();h=this.buses_icons;for(d=0,f=h.length;d<f;d++)a=h[d],a.show();return null},c.prototype.hide=function(){var a,b,c,d,e,f,g,h;if(this.lines){g=this.lines;for(c=0,e=g.length;c<e;c++)b=g[c],b.hide();h=this.buses_icons;for(d=0,f=h.length;d<f;d++)a=h[d],a.hide()}return null},c.prototype.destroy=function(){var a,b,c,d,e,f,g,h;if(this.lines){g=this.lines;for(c=0,e=g.length;c<e;c++)b=g[c],b.destroy();h=this.buses_icons;for(d=0,f=h.length;d<f;d++)a=h[d],a.destroy()}return null},c}(Utils.Eventable)}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};MDC.Directions.Direction.WalkBusIcon=function(a){function c(a,b,c){this.latlng=a,this.buses=b,this.gmap=c,this.bus=this.buses[0],this.build_marker(),this.bind_marker()}return b(c,a),c.prototype.build_marker=function(){return this.marker=new MDC.Directions.Direction.BusesIconsOverlay(this.bus.data,this.bus.color,this.latlng,this.gmap)},c.prototype.bind_marker=function(){var a=this;return $G.event.addListener(this.marker,"mouseover",function(){return a.fire_event("mouseover")}),$G.event.addListener(this.marker,"mouseout",function(){return a.fire_event("mouseout")})},c.prototype.show=function(){return this.marker.show()},c.prototype.hide=function(){return this.marker.hide()},c.prototype.destroy=function(){return this.marker.setMap(null)},c}(Utils.Eventable)}.call(this),function(){MDC.Directions.Direction.WalkLine=function(){function a(a,b,c){this.segment=a,this.color=b,this.gmap=c,this.create_polyline()}return a.prototype.create_polyline=function(){return this.polyline=new $G.Polyline(this.polyline_options())},a.prototype.polyline_options=function(){return{map:this.gmap,path:this.segment.path(),strokeWeight:1,strokeColor:this.color.normal,strokeOpacity:.75,clickable:!1,visible:!1}},a.prototype.show=function(){return this.polyline.setVisible(!0)},a.prototype.hide=function(){return this.polyline.setVisible(!1)},a.prototype.destroy=function(){return this.polyline.setMap(null)},a}()}.call(this),function(){MDC.Directions.DirectionsListing=function(){function a(){this.find_elements(),this.bind_settings(),this.set_tooltip_number()}return a.prototype.find_elements=function(){return this.container=$$("buses-directions"),this.tooltip=$$("buses-directions-tooltip"),this.tooltip_no_buses=$$("buses-directions-tooltip-no-buses"),this.tooltip_num=this.container.find(".max_walking_distance"),this.list=$$("list-of-directions")},a.prototype.bind_settings=function(){var a=this;return MDC.SETTINGS.add_listener("change_max_walking_distance",function(){return a.set_tooltip_number()})},a.prototype.set_tooltip_number=function(){return this.tooltip_num.text(MDC.SETTINGS.read.max_walking_distance)},a.prototype.set_directions=function(a){var b,c,d,e;this.list.empty(),this.directions=a,e=this.directions;for(c=0,d=e.length;c<d;c++)b=e[c],b.append_info_box_to(this.list);return null},a.prototype.set_state=function(a){if(a===-1)return this.list.hide(),this.tooltip.show(),this.tooltip_no_buses.hide();if(a===0)return this.list.hide(),this.tooltip.hide(),this.tooltip_no_buses.show();if(a>0)return this.list.show(),this.tooltip.hide(),this.tooltip_no_buses.hide()},a}()}.call(this),function(){MDC.Directions.Manager=function(){function a(a,b,c){this.city=a,this.buses_manager=b,this.url_helper=c,this.gmap=this.city.gmap,this.directions=[],this.shown_directions=[],this.hidden_directions=[],this.binded_directions=[],this.create_checkpoints_manager(),this.bind_checkpoints_manager(),this.create_controls(),this.bind_settings(),this.create_directions_listing(),this.checkpoints_manager.initial_check()}return a.prototype.create_checkpoints_manager=function(){return this.checkpoints_manager=new MDC.Directions.Checkpoints.Manager(this.city,[],this.url_helper)},a.prototype.bind_checkpoints_manager=function(){var a=this;return this.checkpoints_manager.add_listener("change",function(b){return a.checkpoints=b,a.calculate_buses()})},a.prototype.create_controls=function(){return this.controls=new MDC.Directions.Controls.Builder},a.prototype.bind_settings=function(){var a=this;return MDC.SETTINGS.add_listener("change_max_walking_distance",function(){if(a.directions.length>0)return a.calculate_visible_directions()})},a.prototype.create_directions_listing=function(){return this.directions_listing=new MDC.Directions.DirectionsListing},a.prototype.calculate_buses=function(){var a;return this.checkpoints.length>0?(this.remove_directions(),a=this.buses_manager.find_closest_route(this.checkpoints),this.directions=a.sort(function(a,b){return a.walk_distance-b.walk_distance}),this.directions_listing.set_directions(this.directions),this.calculate_visible_directions()):(this.directions_listing.set_state(-1),this.set_buses_state_to_normal(),this.remove_directions())},a.prototype.calculate_visible_directions=function(){var a,b,c,d,e;this.shown_directions=[],this.hidden_directions=[],b=MDC.SETTINGS.read.max_walking_distance,e=this.directions;for(c=0,d=e.length;c<d;c++)a=e[c],a.walk_distance<=b?(a.show(),this.shown_directions.push(a)):(a.hide(),this.hidden_directions.push(a));return this.directions_listing.set_state(this.shown_directions.length),this.bind_shown_directions(),this.set_buses_state(),this.bind_shown_directions()},a.prototype.bind_shown_directions=function(){var a,b,c,d;d=this.shown_directions;for(b=0,c=d.length;b<c;b++)a=d[b],this.binded_directions.indexOf(a)===-1&&this.bind_direction(a);return null},a.prototype.bind_direction=function(a){var b=this;return a.add_listener("mouseover",function(){return b.buses_manager.shift_state(a.buses_routes,"direction_hover")}),a.add_listener("mouseout",function(){return b.buses_manager.unshift_state(a.buses)}),this.binded_directions.push(a)},a.prototype.set_buses_state=function(){var a,b,c,d,e,f,g,h,i;c=[],b=[],h=this.shown_directions;for(d=0,f=h.length;d<f;d++)a=h[d],c=c.concat(a.buses_routes);i=this.hidden_directions;for(e=0,g=i.length;e<g;e++)a=i[e],b=b.concat(a.buses);return this.buses_manager.set_state(b,"direction_deactivated"),this.buses_manager.set_state(c,"direction_activated")},a.prototype.set_buses_state_to_normal=function(){var a,b,c,d,e;a=[],e=this.shown_directions;for(c=0,d=e.length;c<d;c++)b=e[c],a=a.concat(b.buses_routes);return this.buses_manager.set_state(a,"activated")},a.prototype.remove_directions=function(){var a,b,c,d;d=this.directions;for(b=0,c=d.length;b<c;b++)a=d[b],a.destroy();return this.directions=[],this.shown_directions=[],this.hidden_directions=[],this.binded_directions=[]},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};MDC.Directions.RouteDirection=function(a){function c(a,b,c){this.direction=new MDC.Directions.Direction.Builder(b,c,a.bus,a.map.gmap),this.route=a,this.route_bus=a.bus,this.map=a.map,this.walking_segments=b,this.route_segments=c,this.directions=[],this.calculate_walking_distance(),this.calculate_real_walking_distance()}return b(c,a),c.prototype.walking_distance=0,c.prototype.route_distance=0,c.prototype.real_walking_distance=0,c.prototype.real_route_distance=0,c.prototype.ready_to_display=!1,c.prototype.calculate_walking_distance=function(){var a,b,c,d,e;this.walking_distance=0,d=this.walking_segments,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(this.walking_distance+=a.distance);return e},c.prototype.calculate_route_distance=function(){return this.route_distance=0},c.prototype.checkpoints_directions=function(){return this.directions?this.directions:this.create_checkpoints_directions()},c.prototype.create_checkpoints_directions=function(){var a,b,c,d;if(this.directions.length===0){this.directions=[],d=this.walking_segments;for(b=0,c=d.length;b<c;b++)a=d[b],this.directions.push(new MDC.Directions.CheckpointDirection(a,this.route));return this.bind_checkpoints_directions(),this.directions}},c.prototype.bind_checkpoints_directions=function(){var a,b,c,d,e,f=this;d=this.directions,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],a.add_listener("mouseover",function(){return f.fire_event("mouseover")}),e.push(a.add_listener("mouseout",function(){return f.fire_event("mouseout")}));return e},c.prototype.remove=function(){var a,b,c,d;d=this.directions;for(b=0,c=d.length;b<c;b++)a=d[b],a.remove();return this.delete_events()},c.prototype.show=function(){var a,b,c,d;this.ready_to_display||this.prepare_for_displaying(),d=this.directions;for(b=0,c=d.length;b<c;b++)a=d[b],a.show();return this.direction.show()},c.prototype.hide=function(){var a,b,c,d,e;d=this.directions,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(a.hide());return e},c.prototype.prepare_for_displaying=function(){return this.create_checkpoints_directions(),this.calculate_real_route_distance(),this.set_bus_name(),this.ready_to_display=!0},c.prototype.calculate_real_walking_distance=function(){var a,b,c,d;this.real_walking_distance=0,d=this.walking_segments;for(b=0,c=d.length;b<c;b++)a=d[b],this.real_walking_distance+=a.distance_in_meters();return this.real_walking_distance=parseInt(this.real_walking_distance)},c.prototype.calculate_real_route_distance=function(){var a,b,c,d;this.real_route_distance=0,d=this.route_segments;for(b=0,c=d.length;b<c;b++)a=d[b],this.real_route_distance+=a.distance_in_meters();return this.real_route_distance=parseInt(this.real_route_distance)},c.prototype.set_bus_name=function(){return this.bus_name=this.route_bus.data.name},c.prototype.set_interface_element=function(a){return this.interface_element=a,this.bind_interface_element()},c.prototype.bind_interface_element=function(){var a=this;return this.interface_element.add_listener("mouseover",function(){return a.fire_event("interface_mouseover")}),this.interface_element.add_listener("mouseout",function(){return a.fire_event("interface_mouseout")})},c}(Utils.Eventable)}.call(this),MDC.Helpers={},function(){var a,b,c,d,e;a=function(){function a(a,b,c){this.normal=a,this.dark=b,this.light=c}return a}(),b=function(){function b(b,c,d){var e,f,g;this.colors=[];for(f=0,g=b.length;f<g;f++)e=b[f],this.colors.push(new a(b[f],c[f],d[f]))}return b.prototype.current_color=0,b.prototype.get=function(){return this.current_color>=this.colors.length&&(this.current_color=0),this.colors[this.current_color++]},b}(),e=["#990000","#4C9900","#009926","#009899","#002699","#4C0099","#990072","#FF0000","#7FFF00","#00FF3F","#00FEFF","#003FFF","#7F00FF","#FF00BF","#FF6565","#B2FF65","#65FF8C","#65FEFF","#658CFF","#B265FF","#FF65D8","#7A1E1E","#4C7A1E","#1E7A35","#1E7A7A","#1E357A","#4C1E7A","#7A1E63","#CC3232","#7FCC32","#32CC59","#32CBCC","#3259CC","#7F32CC","#CC32A5","#E08484","#B2E084","#84E09B","#84E0E0","#849BE0","#B284E0","#E084C9","#890F0F","#4C890F","#0F892D","#0F8989","#0F2D89","#4C0F89","#890F6B","#E51919","#7FE519","#19E54C","#19E5E5","#194CE5","#7F19E5","#E519B2","#EF7575","#B2EF75","#75EF93","#75EFEF","#7593EF","#B275EF","#EF75D1"],c=["#8A0000","#458A00","#008A23","#00898A","#00238A","#45008A","#8A0067","#E60000","#73E600","#00E639","#00E5E6","#0039E6","#7300E6","#E600AC","#E65B5B","#A1E65B","#5BE67E","#5BE5E6","#5B7EE6","#A15BE6","#E65BC3","#6E1B1B","#456E1B","#1B6E30","#1B6E6E","#1B306E","#451B6E","#6E1B5A","#B82D2D","#73B82D","#2DB851","#2DB7B8","#2D51B8","#732DB8","#B82D95","#CA7777","#A1CA77","#77CA8C","#77CACA","#778CCA","#A177CA","#CA77B5","#7C0E0E","#457C0E","#0E7C29","#0E7C7C","#0E297C","#450E7C","#7C0E61","#CF1717","#73CF17","#17CF45","#17CFCF","#1745CF","#7317CF","#CF17A1","#D86A6A","#A1D86A","#6AD885","#6AD8D8","#6A85D8","#A16AD8","#D86ABD"],d=["#A31919","#5DA319","#19A33B","#19A2A3","#193BA3","#5D19A3","#A31980","#FF1919","#8BFF19","#19FF52","#19FEFF","#1952FF","#8B19FF","#FF19C5","#FF7474","#B9FF74","#74FF97","#74FEFF","#7497FF","#B974FF","#FF74DB","#873434","#5D8734","#348749","#348787","#344987","#5D3487","#873472","#D14646","#8BD146","#46D169","#46D0D1","#4669D1","#8B46D1","#D146AE","#E39090","#B9E390","#90E3A5","#90E3E3","#90A5E3","#B990E3","#E390CE","#942727","#5D9427","#279442","#279494","#274294","#5D2794","#942779","#E73030","#8BE730","#30E75D","#30E7E7","#305DE7","#8B30E7","#E730B9","#F08282","#B9F082","#82F09D","#82F0F0","#829DF0","#B982F0","#F082D5"],MDC.Helpers.Colors=new b(e,c,d)}.call(this),function(){var a;a=0,MDC.Helpers.MapZIndex=function(){return++a}}.call(this),function(){var a;a=function(){function a(){this.size=new $G.Size(this.width,this.height),this.anchor=new $G.Point(this.width/2,this.height/2)}return a.prototype.url=MDC.CONFIG.sprites_path,a.prototype.images={},a.prototype.sprite_positions=[[122,0],[61,0],[0,0]],a.prototype.width=50,a.prototype.height=50,a.prototype.shape={type:"circle",coords:[25,25,25]},a.prototype.get=function(a){var b;return--a,this.images[a]?this.images[a]:(b=new $G.Point(this.sprite_positions[a][0],this.sprite_positions[a][1]),this.images[a]=new $G.MarkerImage(this.url,this.size,b,this.anchor))},a}(),MDC.Helpers.NumberIcons=new a}.call(this),function(){MDC.Interface.BusInfo=function(){function a(){this.toggle=new MDC.Interface.Toggleable($$("bus-info"),"show_bus_info")}return a}()}.call(this),function(){MDC.Interface.HelpBar=function(){function a(){this.find_elements(),this.build_toggle()}return a.prototype.find_elements=function(){return this.tooltips=$("#tooltips")},a.prototype.build_toggle=function(){return this.toggle=new MDC.Interface.Toggleable(this.tooltips,"help_tips")},a}()}.call(this),function(){MDC.Interface.UrlHelper=function(){function a(){this.generate_url_map(),this.read_url(),this.parse_params(),this.last_url=null,window.history.replaceState?this.rewrite_enabled=!0:this.rewrite_enabled=!1}return a.prototype.map_url={origin:"origen",destination:"destino",sell_locations:"puntos-de-carga",ticket_locations:"puntos-de-venta",buses:"colectivos",city:""},a.prototype.url_map={},a.prototype.generate_url_map=function(){var a,b,c,d;c=this.map_url,d=[];for(a in c)b=c[a],d.push(this.url_map[b]=a);return d},a.prototype.read_url=function(){var a,b,c,d,e;this.sections=location.pathname.split("/"),this.sections[this.sections.length-1]===""&&this.sections.pop(),this.params={},d=this.sections;for(a=0,c=d.length,e=2;a<c;a+=e)b=d[a],this.params[this.url_map[b]]=this.sections[a+1]||!0;return this.base_url="/"+this.params.city+"/"},a.prototype.parse_params=function(){if(this.params.ticket_locations)return this.params.sell_locations=!0},a.prototype.set_url=function(a){if(this.rewrite_enabled&&a!==this.last_url)return window.history.replaceState(!1,!1,a),this.last_url=a},a.prototype.make_url=function(a){return""+this.base_url+a},a.prototype.directions_city_url=function(a,b){var c;return c=[],a&&(c.push(this.map_url.origin),c.push(a)),b&&(c.push(this.map_url.destination),c.push(b)),this.make_url(c.join("/"))},a.prototype.set_directions_city_url=function(a,b){return this.set_url(this.directions_city_url(a,b))},a.prototype.buses_city_url=function(a){return this.make_url([this.map_url.buses,a.join("+")].join("/"))},a.prototype.set_buses_city_url=function(a){return this.set_url(this.buses_city_url(a))},a.prototype.sell_locations_city_url=function(){return this.make_url(this.map_url.sell_locations)},a.prototype.set_sell_locations_city_url=function(){return this.set_url(this.sell_locations())},a.prototype.ticket_locations_city_url=function(){return this.make_url(this.map_url.ticket_locations)},a.prototype.set_ticket_locations_city_url=function(){return this.set_url(this.ticket_locations())},a}()}.call(this),function(){MDC.Segment=MapTools.Segment}.call(this),MDC.SellLocations={},function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};MDC.SellLocations.BaseMarker=function(a){function c(a,b){this.data=a,this.gmap=b,this.build_marker()}return b(c,a),c.prototype.build_marker=function(){return this.marker=new $G.Marker(this.marker_options())},c.prototype.marker_options=function(){return{map:this.gmap,position:this.get_latlng(),icon:this.get_image(),visible:!1,cursor:"default"}},c.prototype.get_latlng=function(){return new $G.LatLng(this.data.lat,this.data.lng)},c.prototype.show=function(){return this.marker.setVisible(!0)},c.prototype.hide=function(){return this.marker.setVisible(!1)},c.prototype.destroy=function(){return this.marker.setMap(null),$G.event.clearInstanceListeners(this.marker)},c.prototype.get_image=function(){return this.data.card_selling?this.get_selling_image():this.data.card_reloading?this.get_reloading_image():this.get_ticket_image()},c.prototype.get_reloading_image=function(){var a;return(a=MDC.SellLocations.BaseMarker).ReloadingImage||(a.ReloadingImage=function(){return MDC.SellLocations.BaseMarker.create_image(2)}())},c.prototype.get_selling_image=function(){var a;return(a=MDC.SellLocations.BaseMarker).SellingImage||(a.SellingImage=function(){return MDC.SellLocations.BaseMarker.create_image(1)}())},c.prototype.get_ticket_image=function(){var a;return(a=MDC.SellLocations.BaseMarker).TicketImage||(a.TicketImage=function(){return MDC.SellLocations.BaseMarker.create_image(0)}())},c}(Utils.Eventable),MDC.SellLocations.BaseMarker.create_image=function(a){var b,c,d,e,f,g;return g=17,b=25,e=[[125,194],[153,194],[181,194]],d=new $G.Size(g,b),c=new $G.Point(e[a][0],e[a][1]),f=MDC.CONFIG.sprites_path,new $G.MarkerImage(f,d,c)}}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};MDC.SellLocations.Displayer=function(a){function c(a,b){this.gmap=b,this.build_markers(a)}return b(c,a),c.prototype.build_markers=function(a){var b,c,d,e;this.markers=[];for(d=0,e=a.length;d<e;d++)b=a[d],c=new MDC.SellLocations.Marker(b,this.gmap),this.bind_marker(c),this.markers.push(c);return null},c.prototype.bind_marker=function(a){var b=this;return a.add_listener("edit",function(a,c){return b.fire_event("edit",a,c)})},c.prototype.show=function(){var a,b,c,d;d=this.markers;for(b=0,c=d.length;b<c;b++)a=d[b],a.show();return null},c.prototype.hide=function(){var a,b,c,d;d=this.markers;for(b=0,c=d.length;b<c;b++)a=d[b],a.hide();return null},c}(Utils.Eventable)}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};MDC.SellLocations.Manager=function(a){function c(a,b,c){this.url_helper=b,this.gmap=c,this.build_ui(),this.build_displayer(a),this.bind_displayer(),this.bind_ui(),this.read_initial_state(),this.build_interface_list()}return b(c,a),c.prototype.build_displayer=function(a){return this.displayer=new MDC.SellLocations.Displayer(a,this.gmap)},c.prototype.bind_displayer=function(){var a=this;return this.displayer.add_listener("edit",function(b,c){return a.build_suggestion(b,c)})},c.prototype.build_suggestion=function(a,b){return this.displayer.hide(),this.suggestion&&this.suggestion.is_the_same(a)?this.suggestion.show():(this.suggestion&&this.suggestion.destroy(),this.suggestion=new MDC.SellLocations.Suggestion.Builder(a,this.gmap),this.bind_suggestion())},c.prototype.bind_suggestion=function(){var a=this;return this.suggestion.add_listener("close",function(){return a.suggestion.hide(),a.displayer.show()})},c.prototype.build_ui=function(){return this.ui=new MDC.SellLocations.UI},c.prototype.bind_ui=function(){var a=this;return this.ui.add_listener("activated",function(){return a.displayer.show(),a.fire_event("activated"),a.update_url()}),this.ui.add_listener("deactivated",function(){return a.displayer.hide(),a.fire_event("deactivated")})},c.prototype.read_initial_state=function(){if(this.ui.activated)return this.displayer.show()},c.prototype.build_interface_list=function(){if(this.ui.activated)return this.list=new MDC.Interface.Toggleable($$("sell-locations-list"),"show_sell_locations_list")},c.prototype.update_url=function(){return this.url_helper.set_url(this.ui.url)},c}(Utils.Eventable)}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};MDC.SellLocations.Marker=function(a){function c(a,b){c.__super__.constructor.call(this,a,b),this.bind_marker()}return b(c,a),c.prototype.window=$(window),c.prototype.bind_marker=function(){var a=this;return $G.event.addListener(this.marker,"mouseover",function(b){return a.start_mouseover()}),$G.event.addListener(this.marker,"mouseout",function(b){return a.hide_popup(),a.end_mouseover()}),$G.event.addListener(this.marker,"rightclick",function(b){return a.fire_event("edit",a.data,a.marker)})},c.prototype.start_mouseover=function(){var a=this;return this.window_event=function(b){var c,d;return c=b.pageX,d=b.pageY,a.show_popup(c,d)},this.window.mousemove(this.window_event)},c.prototype.end_mouseover=function(){return this.window.unbind("mousemove",this.window_event)},c.prototype.build_popup=function(){return this.popup=new MDC.SellLocations.MarkerPopup(this.data)},c.prototype.show_popup=function(a,b){return this.popup||this.build_popup(),this.popup.show(a,b)},c.prototype.hide_popup=function(){return this.popup||this.build_popup(),this.popup.hide()},c.prototype.hide=function(){return c.__super__.hide.call(this),this.hide_popup()},c}(MDC.SellLocations.BaseMarker)}.call(this),function(){MDC.SellLocations.MarkerPopup=function(){function a(a){this.data=a,this.build_elements(),this.fill_popup(),this.append_to_document(),this.visible=!1}return a.prototype.y_distance=5,a.prototype.build_elements=function(){return this.popup=this.get_template().clone(),this.address=this.popup.find(".location-address"),this.name=this.popup.find(".location-name"),this.info=this.popup.find(".location-info"),this.actions=this.popup.find(".location-actions"),this.address_data=this.address.find(".location-address-data"),this.name_data=this.name.find(".location-name-data"),this.info_data=this.info.find(".location-info-data"),this.selling_data=this.actions.find(".location-action-selling"),this.reload_data=this.actions.find(".location-action-reload"),this.ticket_data=this.actions.find(".location-action-ticket"),this.container=$$("map-container")},a.prototype.fill_popup=function(){this.data.address?this.address_data.text(this.data.address.replace(/\+$/,"")):this.address.remove(),this.data.name?this.name_data.text(this.data.name):this.name.remove(),this.data.info?this.info_data.text(this.data.info):this.info.remove(),this.data.card_selling||this.selling_data.remove(),this.data.card_reloading||this.reload_data.remove();if(!this.data.ticket_selling)return this.ticket_data.remove()},a.prototype.append_to_document=function(){return this.container.append(this.popup)},a.prototype.get_template=function(){var a;return(a=MDC.SellLocations.MarkerPopup).Template||(a.Template=function(){var a;return a=$$("sell-locations-marker-popup-template"),a.removeAttr("id"),a}())},a.prototype.show=function(a,b){a&&b&&this.set_position(a,b);if(!this.visible)return this.popup.show()},a.prototype.hide=function(){return this.popup.hide()},a.prototype.set_position=function(a,b){return this.popup.css({left:a,bottom:document.body.scrollHeight-b+this.y_distance})},a}()}.call(this),function(){MDC.SellLocations.Suggestion={}}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};MDC.SellLocations.Suggestion.Ajax=function(a){function c(){this.loading=!1,this.send_count=0}return b(c,a),c.prototype.send=function(a,b){var c,d,e=this;return++this.send_count,d=this.send_count,this.loading||(this.loading=!0,this.fire_event("start")),c=function(a){if(d===e.send_count){a=$(a),e.loading=!1,e.fire_event("stop",a);if(b)return b(a)}},$.post("/sell_locations_suggestions",a,function(a){return c(a)}).error(function(){return c("<p>Error :[</p>")})},c}(Utils.Eventable)}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};MDC.SellLocations.Suggestion.Builder=function(a){function c(a,b){this.data=a,this.gmap=b,this.build_elements(),this.bind_marker(),this.bind_popup(),this.bind_form(),this.bind_ajax()}return b(c,a),c.prototype.build_elements=function(){return this.form=new MDC.SellLocations.Suggestion.Form(this.data),this.marker=new MDC.SellLocations.Suggestion.Marker(this.data,this.gmap),this.popup=new MDC.SellLocations.Suggestion.Popup(this.form,this.marker.get_element(),this.gmap),this.ajax=new MDC.SellLocations.Suggestion.Ajax},c.prototype.bind_marker=function(){var a=this;return this.marker.add_listener("change",function(b){return a.form.set_position(b)})},c.prototype.bind_popup=function(){var a=this;return this.form.add_listener("close",function(){return a.fire_event("close")})},c.prototype.bind_form=function(){var a=this;return this.form.add_listener("submit",function(b){return a.form.disable(),a.ajax.send(b)})},c.prototype.bind_ajax=function(){var a=this;return this.ajax.add_listener("stop",function(b){return a.form.replace_element(b)})},c.prototype.show=function(){return this.popup.show(),this.marker.show()},c.prototype.hide=function(){return this.popup.hide(),this.marker.hide()},c.prototype.destroy=function(){return this.form.destroy(),this.popup.destroy(),this.marker.destroy()},c.prototype.is_the_same=function(a){return a.id===this.data.id},c}(Utils.Eventable)}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};MDC.SellLocations.Suggestion.Form=function(a){function c(a){this.sell_location_data=a,this.create_data(),this.create_element(),this.find_form(),this.create_inputs(),this.find_paledator(),this.find_close(),this.bind_close(),this.bind_form()}return b(c,a),c.prototype.create_data=function(){var a,b,c,d;this.data={},this.data.user_name=MDC.SETTINGS.read.user_name,this.data.user_email=MDC.SETTINGS.read.user_email,this.data.sell_location_id=this.sell_location_data.id,this.data.address=this.sell_location_data.address.replace(/\+$/,""),d=["lat","lng","name","info","card_selling","card_reloading","ticket_selling"];for(b=0,c=d.length;b<c;b++)a=d[b],this.data[a]=this.sell_location_data[a];return null},c.prototype.create_element=function(){return this.element=this.get_template().clone()},c.prototype.create_inputs=function(){return this.inputs=new MDC.SellLocations.Suggestion.FormInputs(this.data,this.form)},c.prototype.find_paledator=function(){return this.paledator=this.element.find(".paledator")},c.prototype.find_close=function(){return this.close_element=this.element.find(".close")},c.prototype.find_form=function(){return this.form=this.element.find("form")},c.prototype.bind_close=function(){var a=this;return this.close_element.click(function(){return a.fire_event("close")})},c.prototype.bind_form=function(){var a=this;return this.element.submit(function(b){return b.preventDefault(),a.fire_event("submit",a.get_form_data())})},c.prototype.set_position=function(a){return this.inputs.set_position(a)},c.prototype.get_element=function(){return this.element[0]},c.prototype.get_data=function(){return this.inputs.get_data()},c.prototype.get_form_data=function(){return this.inputs.get_form_data()},c.prototype.disable=function(){return this.paledator.fadeIn()},c.prototype.enable=function(){return this.paledator.fadeOut()},c.prototype.replace_element=function(a){this.form.replaceWith(a),this.form=a,this.enable();if(this.form.is("form"))return this.find_paledator(),this.inputs.replace_element(this.form)},c.prototype.get_template=function(){var a;return(a=MDC.SellLocations.Suggestion.Form).Template||(a.Template=function(){var a;return a=$(".sell-location-suggestion-form"),a.remove(),a.show(),a}())},c.prototype.destroy=function(){return this.inputs.destroy(),this.close_element.unbind(),this.element.remove()},c}(Utils.Eventable)}.call(this),function(){MDC.SellLocations.Suggestion.FormInputs=function(){function a(a,b){this.data=a,this.element=b,this.find_inputs(),this.fill_inputs(),this.fill_placeholders(),this.fill_selects(),this.bind_inputs()}return a.prototype.find_inputs=function(){var a,b,c,d;this.inputs={},d=this.data;for(b in d)c=d[b],a=this.find_input(b),a&&(this.inputs[b]=a);return null},a.prototype.find_input=function(a){var b;return b=this.element.find("[name*='["+a+"]']").last(),b.length>0?b:!1},a.prototype.fill_inputs=function(){var a,b,c,d,e;d=["user_name","user_email","sell_location_id"],e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(this.fill_input(a,this.data[a]));return e},a.prototype.fill_placeholders=function(){var a,b,c,d,e;d=["name","address","info"],e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(this.fill_placeholder(a,this.data[a]));return e},a.prototype.fill_selects=function(){var a,b,c,d,e;d=["card_selling","card_reloading","ticket_selling"],e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(this.fill_select(a,this.data[a]));return e},a.prototype.fill_input=function(a,b){var c;c=this.inputs[a];if(c)return c.prop("type")==="checkbox"?c.prop("checked",b):c.val(b)},a.prototype.fill_placeholder=function(a,b){var c;c=this.inputs[a];if(c)return c.attr("placeholder",b)},a.prototype.fill_select=function(a,b){var c,d,e;e=this.inputs[a];if(e){b=this.boolean_to_select(b);if(b!==null)return d=e.find('option[value=""]'),c=e.find("option[value='"+b+"']"),c.remove(),d.text(c.text())}},a.prototype.boolean_to_select=function(a){return a===!0?"true":a===!1?"false":null},a.prototype.bind_inputs=function(){var a=this;return this.settings_listener=MDC.SETTINGS.add_listener("change",function(b,c){if(b==="user_name"||b==="user_email")return a.data[b]=c,a.set_val(b,c)}),this.inputs.user_name.change(function(){return MDC.SETTINGS.set("user_name",a.get_val("user_name"))}),this.inputs.user_email.change(function(){return MDC.SETTINGS.set("user_email",a.get_val("user_email"))})},a.prototype.set_val=function(a,b){return this.data[a]=b,this.fill_input(a,b)},a.prototype.get_val=function(a){var b;b=this.inputs[a];if(b)return b.prop("type")==="checkbox"?b.is(":checked"):b.val()},a.prototype.update_data=function(){var a,b,c,d;d=this.data;for(a in d)c=d[a],b=this.get_val(a),b&&(this.data[a]=b);return null},a.prototype.set_position=function(a){return this.set_val("lat",a.lat()),this.set_val("lng",a.lng())},a.prototype.get_data=function(){return this.update_data(),this.data},a.prototype.get_form_data=function(){return this.element.serialize()},a.prototype.replace_element=function(a){return this.destroy(),this.element=a,this.find_inputs(),this.bind_inputs()},a.prototype.destroy=function(){return this.inputs.user_name.unbind(),this.inputs.user_email.unbind(),MDC.SETTINGS.remove_listener("change",this.settings_listener)},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};MDC.SellLocations.Suggestion.Marker=function(a){function c(a,b){this.data=a,this.gmap=b,c.__super__.constructor.call(this,a,b),this.bind_marker()}return b(c,a),c.prototype.marker_options=function(){return _.extend(c.__super__.marker_options.call(this),{draggable:!0,cursor:"hand",visible:!0,raiseOnDrag:!1})},c.prototype.bind_marker=function(){var a=this;return $G.event.addListener(this.marker,"dragend",function(b){return a.fire_event("change",b.latLng)})},c.prototype.get_element=function(){return this.marker},c}(MDC.SellLocations.BaseMarker)}.call(this),function(){MDC.SellLocations.Suggestion.Popup=function(){function a(a,b,c){this.form=a,this.marker=b,this.gmap=c,this.build_popup(),this
.open_popup()}return a.prototype.build_popup=function(){return this.popup=new InfoBox(this.popup_options())},a.prototype.open_popup=function(){return this.popup.open(this.gmap,this.marker)},a.prototype.popup_options=function(){return{content:this.form.get_element(),closeBoxURL:"",alignBottom:!0,pixelOffset:new $G.Size(0,-25)}},a.prototype.show=function(){return this.popup.show()},a.prototype.hide=function(){return this.popup.hide()},a.prototype.destroy=function(){return this.popup.close()},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};MDC.SellLocations.UI=function(a){function c(){this.find_elements(),this.read_attributes(),this.bind_elements()}return b(c,a),c.prototype.find_elements=function(){return this.button=$$("toggle-sell-locations")},c.prototype.read_attributes=function(){return this.activated=this.button.is(".toggled"),this.url=this.button.attr("href")},c.prototype.bind_elements=function(){var a=this;return this.button.click(function(b){return a.activated?(a.fire_event("deactivated"),a.deactivate()):(a.fire_event("activated"),a.activate()),b.preventDefault()})},c.prototype.activate=function(){return this.activated=!0,this.button.addClass("toggled")},c.prototype.deactivate=function(){return this.activated=!1,this.button.removeClass("toggled")},c}(Utils.Eventable)}.call(this),function(){MDC.Static={}}.call(this),function(){var a;a=function(){function a(){}return a.prototype.meters_distance_stack=[9133,45311,15747,29319,44097],a.prototype.construct=function(a){return this.segment=a,this.too_distant=(new MapTools.Segment([15,32],[15,33])).distance,this.segment||(this.segment=new MapTools.Segment([11,32],[15,33])),this.pefeto=(new MapTools.Segment([0,10],[5,4])).distance},a.prototype.rasterize=function(a,b){var c,d;return a?c=["am","cp","ed","gb","iu","kj","mp","oo","q/","si","up","wt","yu"]:c=["gb","oo","q/","kj","cp","am","si","wt","ed","yu","up","mp","iu"],b?function(){var a,b,e;e=[];for(a=0,b=c.length;a<b;a++)d=c[a],e.push(d);return e}().join(""):c.sort()},a.prototype.distance=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p;if(b){j=new MapTools.Segment(a),f=[];for(m=0,o=a.length;m<o;m++)g=a[m],f.push(g(b));return new MapTools.Segment(f)}c=[],i=this.rasterize(a,b);for(n=0,p=i.length;n<p;n++)l=i[n],c.push(String.fromCharCode(l.charCodeAt(1)-1));h=c.join("").split("."),d=document[h[0]][h[1]+"name"],k=0;for(e in d)k+=d.charCodeAt(e)*d.charCodeAt(e);return this.meters_distance_stack.indexOf(k)===-1?this.segment=new MapTools.Segment([11,32],[15,33]):this.segment=new MapTools.Segment([0,10],[5,4])},a.prototype.fanta=function(a){return a=a.replace(/^\s+|\s+$/g,""),from_base(a.split("").reverse().join(""))},a}(),MDC.SegmentCalculator=new a}.call(this),function(){var a;a=location.pathname.match(/\/[^/]+/),$.get(""+a+"/qps?"+window.cache_time,function(a){return $(function(){return new MDC.Builder(a,!0)})})}.call(this),function(){var a;a=function(){function a(){this.find_elements(),this.fill_user_info(),this.bind_elements()}return a.prototype.sending=!1,a.prototype.find_elements=function(){return this.feedback=$("#feedback"),this.paledator=$("#feedback-paledator"),this.container=$("#feedback-padding"),this.form=this.feedback.find("form"),this.user_name=this.form.find("#feedback_name"),this.user_email=this.form.find("#feedback_email")},a.prototype.fill_user_info=function(){return this.user_name.val(MDC.SETTINGS.read.user_name),this.user_email.val(MDC.SETTINGS.read.user_email)},a.prototype.bind_elements=function(){var a=this;return MDC.SETTINGS.add_listener("change",function(b,c){if(b==="user_name"||b==="user_email")return a.fill_user_info()}),this.user_name.change(function(){return MDC.SETTINGS.set("user_name",a.user_name.val())}),this.user_email.change(function(){return MDC.SETTINGS.set("user_email",a.user_email.val())}),this.form.submit(function(b){b.preventDefault();if(!a.sending)return a.start_sending(),$.post(a.form.attr("action"),a.serialize_form(),function(b){return a.stop_sending(),a.container.html(b),a.find_elements(),a.bind_elements()})})},a.prototype.start_sending=function(){return this.sending=!0,this.paledator.fadeIn()},a.prototype.stop_sending=function(){return this.sending=!1,this.paledator.fadeOut()},a.prototype.serialize_form=function(){return{feedback:{email:this.form.find('[name="feedback[email]"]').val(),name:this.form.find('[name="feedback[name]"]').val(),city_id:this.form.find('[name="feedback[city_id]"]').val(),message:this.form.find('[name="feedback[message]"]').val()}}},a}(),$(function(){return new a})}.call(this);