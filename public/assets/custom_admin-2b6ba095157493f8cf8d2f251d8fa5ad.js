/*

 jQuery Cookie Plugin
 https://github.com/carhartl/jquery-cookie

 Copyright 2011, Klaus Hartl
 Dual licensed under the MIT or GPL Version 2 licenses.
 http://www.opensource.org/licenses/mit-license.php
 http://www.opensource.org/licenses/GPL-2.0

 Underscore.js 1.3.3
 (c) 2009-2012 Jeremy Ashkenas, DocumentCloud Inc.
 Underscore is freely distributable under the MIT license.
 Portions of Underscore are inspired or borrowed from Prototype,
 Oliver Steele's Functional, and John Resig's Micro-Templating.
 For all details and documentation:
 http://documentcloud.github.com/underscore
*/
var h=void 0,j=!0,k=null,l=!1;
(function(g){g.cookie=function(d,e,a){if(1<arguments.length&&(!/Object/.test(Object.prototype.toString.call(e))||e===k||e===h)){a=g.extend({},a);if(e===k||e===h)a.G=-1;if("number"===typeof a.G){var f=a.G,b=a.G=new Date;b.setDate(b.getDate()+f)}e=""+e;return document.cookie=[encodeURIComponent(d),"=",a.ac?e:encodeURIComponent(e),a.G?"; expires="+a.G.toUTCString():"",a.path?"; path="+a.path:"",a.domain?"; domain="+a.domain:"",a.Yc?"; secure":""].join("")}for(var a=e||{},f=a.ac?function(b){return b}:
decodeURIComponent,b=document.cookie.split("; "),v=0,p;p=b[v]&&b[v].split("=");v++)if(f(p[0])===d)return f(p[1]||"");return k}})(jQuery);
(function(){function g(c,i){e.prototype[c]=function(){var c=m.call(arguments);x.call(c,this.z);return d(i.apply(b,c),this.C)}}function d(c,i){return i?b(c).X():c}function e(c){this.z=c}function a(c){return c.replace(W,function(c,b){return A[b]})}function f(){}function b(c){return new e(c)}function v(c,i,a){if(c===i)return 0!==c||1/c==1/i;if(c==k||i==k)return c===i;c.C&&(c=c.z);i.C&&(i=i.z);if(c.isEqual&&b.isFunction(c.isEqual))return c.isEqual(i);if(i.isEqual&&b.isFunction(i.isEqual))return i.isEqual(c);
var d=o.call(c);if(d!=o.call(i))return l;switch(d){case "[object String]":return c==""+i;case "[object Number]":return c!=+c?i!=+i:0==c?1/c==1/i:c==+i;case "[object Date]":case "[object Boolean]":return+c==+i;case "[object RegExp]":return c.source==i.source&&c.global==i.global&&c.multiline==i.multiline&&c.ignoreCase==i.ignoreCase}if("object"!=typeof c||"object"!=typeof i)return l;for(var f=a.length;f--;)if(a[f]==c)return j;a.push(c);var f=0,e=j;if("[object Array]"==d){if(f=c.length,e=f==i.length)for(;f--&&
(e=f in c==f in i&&v(c[f],i[f],a)););}else{if("constructor"in c!="constructor"in i||c.constructor!=i.constructor)return l;for(var g in c)if(b.has(c,g)&&(f++,!(e=b.has(i,g)&&v(c[g],i[g],a))))break;if(e){for(g in i)if(b.has(i,g)&&!f--)break;e=!f}}a.pop();return e}var p=this,u=p.ra,q={},n=Array.prototype,t=Object.prototype,m=n.slice,x=n.unshift,o=t.toString,L=t.hasOwnProperty,F=n.forEach,G=n.map,z=n.reduce,H=n.reduceRight,B=n.filter,C=n.every,I=n.some,y=n.indexOf,D=n.lastIndexOf,t=Array.isArray,X=Object.keys,
M=Function.prototype.bind;"undefined"!==typeof exports?("undefined"!==typeof module&&module.Db&&(exports=module.Db=b),exports.ra=b):p._=b;b.VERSION="1.3.3";var s=b.each=b.forEach=function(c,a,f){if(c!=k)if(F&&c.forEach===F)c.forEach(a,f);else if(c.length===+c.length)for(var d=0,e=c.length;d<e;d++){if(d in c&&a.call(f,c[d],d,c)===q)break}else for(d in c)if(b.has(c,d)&&a.call(f,c[d],d,c)===q)break};b.map=b.xc=function(c,b,a){var f=[];if(c==k)return f;if(G&&c.map===G)return c.map(b,a);s(c,function(c,
d,e){f[f.length]=b.call(a,c,d,e)});if(c.length===+c.length)f.length=c.length;return f};b.reduce=b.Ac=b.Ec=function(c,a,f,d){var e=arguments.length>2;c==k&&(c=[]);if(z&&c.reduce===z){d&&(a=b.bind(a,d));return e?c.reduce(a,f):c.reduce(a)}s(c,function(c,b,g){if(e)f=a.call(d,f,c,b,g);else{f=c;e=j}});if(!e)throw new TypeError("Reduce of empty array with no initial value");return f};b.reduceRight=b.Bc=function(c,a,f,d){var e=arguments.length>2;c==k&&(c=[]);if(H&&c.reduceRight===H){d&&(a=b.bind(a,d));return e?
c.reduceRight(a,f):c.reduceRight(a)}var g=b.toArray(c).reverse();d&&!e&&(a=b.bind(a,d));return e?b.reduce(g,a,f,d):b.reduce(g,a)};b.find=b.zc=function(c,b,a){var f;S(c,function(c,d,e){if(b.call(a,c,d,e)){f=c;return j}});return f};b.filter=b.select=function(c,b,a){var f=[];if(c==k)return f;if(B&&c.filter===B)return c.filter(b,a);s(c,function(c,d,e){b.call(a,c,d,e)&&(f[f.length]=c)});return f};b.reject=function(c,b,a){var f=[];if(c==k)return f;s(c,function(c,d,e){b.call(a,c,d,e)||(f[f.length]=c)});
return f};b.every=b.all=function(c,b,a){var f=j;if(c==k)return f;if(C&&c.every===C)return c.every(b,a);s(c,function(c,d,e){if(!(f=f&&b.call(a,c,d,e)))return q});return!!f};var S=b.some=b.vc=function(c,a,f){a||(a=b.P);var d=l;if(c==k)return d;if(I&&c.some===I)return c.some(a,f);s(c,function(c,b,e){if(d||(d=a.call(f,c,b,e)))return q});return!!d};b.Da=b.contains=function(c,b){var a=l;if(c==k)return a;if(y&&c.indexOf===y)return c.indexOf(b)!=-1;return a=S(c,function(c){return c===b})};b.Hc=function(c,
a){var f=m.call(arguments,2);return b.map(c,function(c){return(b.isFunction(a)?a||c:c[a]).apply(c,f)})};b.ja=function(c,a){return b.map(c,function(c){return c[a]})};b.max=function(c,a,f){if(!a&&b.isArray(c)&&c[0]===+c[0])return Math.max.apply(Math,c);if(!a&&b.isEmpty(c))return-Infinity;var d={F:-Infinity};s(c,function(c,b,e){b=a?a.call(f,c,b,e):c;b>=d.F&&(d={value:c,F:b})});return d.value};b.min=function(c,a,f){if(!a&&b.isArray(c)&&c[0]===+c[0])return Math.min.apply(Math,c);if(!a&&b.isEmpty(c))return Infinity;
var d={F:Infinity};s(c,function(c,b,e){b=a?a.call(f,c,b,e):c;b<d.F&&(d={value:c,F:b})});return d.value};b.Zc=function(c){var b=[],a;s(c,function(c,f){a=Math.floor(Math.random()*(f+1));b[f]=b[a];b[a]=c});return b};b.$c=function(c,a,f){var d=b.isFunction(a)?a:function(c){return c[a]};return b.ja(b.map(c,function(c,b,a){return{value:c,wa:d.call(f,c,b,a)}}).sort(function(c,b){var a=c.wa,f=b.wa;return a===h?1:f===h?-1:a<f?-1:a>f?1:0}),"value")};b.Cc=function(c,a){var f={},d=b.isFunction(a)?a:function(c){return c[a]};
s(c,function(c,b){var a=d(c,b);(f[a]||(f[a]=[])).push(c)});return f};b.gc=function(c,a){var f;f||(f=b.P);for(var d=0,e=c.length;d<e;){var g=d+e>>1;f(c[g])<f(a)?d=g+1:e=g}return d};b.toArray=function(c){return!c?[]:b.isArray(c)||b.ea(c)?m.call(c):c.toArray&&b.isFunction(c.toArray)?c.toArray():b.sc(c)};b.size=function(c){return b.isArray(c)?c.length:b.keys(c).length};b.first=b.head=b.bd=function(c,b,a){return b!=k&&!a?m.call(c,0,b):c[0]};b.Dc=function(c,b,a){return m.call(c,0,c.length-(b==k||a?1:b))};
b.last=function(c,b,a){return b!=k&&!a?m.call(c,Math.max(c.length-b,0)):c[c.length-1]};b.Xc=b.ad=function(c,b,a){return m.call(c,b==k||a?1:b)};b.compact=function(c){return b.filter(c,function(c){return!!c})};b.O=function(c,a){return b.reduce(c,function(c,f){if(b.isArray(f))return c.concat(a?f:b.O(f));c[c.length]=f;return c},[])};b.hd=function(c){return b.xb(c,m.call(arguments,1))};b.Ka=b.unique=function(c,a,f){var f=f?b.map(c,f):c,d=[];c.length<3&&(a=j);b.reduce(f,function(f,e,g){if(a?b.last(f)!==
e||!f.length:!b.Da(f,e)){f.push(e);d.push(c[g])}return f},[]);return d};b.union=function(){return b.Ka(b.O(arguments,j))};b.Gc=b.Fc=function(c){var a=m.call(arguments,1);return b.filter(b.Ka(c),function(c){return b.every(a,function(a){return b.indexOf(a,c)>=0})})};b.xb=function(c){var a=b.O(m.call(arguments,1),j);return b.filter(c,function(c){return!b.Da(a,c)})};b.jd=function(){for(var c=m.call(arguments),a=b.max(b.ja(c,"length")),f=Array(a),d=0;d<a;d++)f[d]=b.ja(c,""+d);return f};b.indexOf=function(c,
a,f){if(c==k)return-1;var d;if(f){f=b.gc(c,a);return c[f]===a?f:-1}if(y&&c.indexOf===y)return c.indexOf(a);f=0;for(d=c.length;f<d;f++)if(f in c&&c[f]===a)return f;return-1};b.lastIndexOf=function(c,b){if(c==k)return-1;if(D&&c.lastIndexOf===D)return c.lastIndexOf(b);for(var a=c.length;a--;)if(a in c&&c[a]===b)return a;return-1};b.Vc=function(c,b,a){if(arguments.length<=1){b=c||0;c=0}for(var a=arguments[2]||1,f=Math.max(Math.ceil((b-c)/a),0),d=0,e=Array(f);d<f;){e[d++]=c;c=c+a}return e};b.bind=function(c,
a){var d,e;if(c.bind===M&&M)return M.apply(c,m.call(arguments,1));if(!b.isFunction(c))throw new TypeError;e=m.call(arguments,2);return d=function(){if(!(this instanceof d))return c.apply(a,e.concat(m.call(arguments)));f.prototype=c.prototype;var b=new f,g=c.apply(b,e.concat(m.call(arguments)));return Object(g)===g?g:b}};b.wc=function(c){var a=m.call(arguments,1);a.length==0&&(a=b.Aa(c));s(a,function(a){c[a]=b.bind(c[a],c)});return c};b.Qc=function(c,a){var f={};a||(a=b.P);return function(){var d=
a.apply(this,arguments);return b.has(f,d)?f[d]:f[d]=c.apply(this,arguments)}};b.delay=function(c,b){var a=m.call(arguments,2);return setTimeout(function(){return c.apply(k,a)},b)};b.defer=function(c){return b.delay.apply(b,[c,1].concat(m.call(arguments,1)))};b.ed=function(c,a){var f,d,e,g,v,D,y=b.vb(function(){v=g=l},a);return function(){f=this;d=arguments;e||(e=setTimeout(function(){e=k;v&&c.apply(f,d);y()},a));g?v=j:D=c.apply(f,d);y();g=j;return D}};b.vb=function(c,b){var a;return function(){var f=
this,d=arguments;clearTimeout(a);a=setTimeout(function(){a=k;c.apply(f,d)},b)}};b.Tc=function(c){var b=l,a;return function(){if(b)return a;b=j;return a=c.apply(this,arguments)}};b.wrap=function(c,b){return function(){var a=[c].concat(m.call(arguments,0));return b.apply(this,a)}};b.yc=function(){var c=arguments;return function(){for(var b=arguments,a=c.length-1;a>=0;a--)b=[c[a].apply(this,b)];return b[0]}};b.after=function(c,b){return c<=0?b():function(){if(--c<1)return b.apply(this,arguments)}};b.keys=
X||function(c){if(c!==Object(c))throw new TypeError("Invalid object");var a=[],f;for(f in c)b.has(c,f)&&(a[a.length]=f);return a};b.sc=function(c){return b.map(c,b.P)};b.Aa=b.Sc=function(c){var a=[],f;for(f in c)b.isFunction(c[f])&&a.push(f);return a.sort()};b.extend=function(c){s(m.call(arguments,1),function(b){for(var a in b)c[a]=b[a]});return c};b.Uc=function(c){var a={};s(b.O(m.call(arguments,1)),function(b){b in c&&(a[b]=c[b])});return a};b.wb=function(c){s(m.call(arguments,1),function(b){for(var a in b)c[a]==
k&&(c[a]=b[a])});return c};b.clone=function(c){return!b.Ob(c)?c:b.isArray(c)?c.slice():b.extend({},c)};b.cd=function(c,b){b(c);return c};b.isEqual=function(c,b){return v(c,b,[])};b.isEmpty=function(c){if(c==k)return j;if(b.isArray(c)||b.Pb(c))return c.length===0;for(var a in c)if(b.has(c,a))return l;return j};b.Kc=function(c){return!!(c&&c.nodeType==1)};b.isArray=t||function(c){return o.call(c)=="[object Array]"};b.Ob=function(c){return c===Object(c)};b.ea=function(c){return o.call(c)=="[object Arguments]"};
b.ea(arguments)||(b.ea=function(c){return!(!c||!b.has(c,"callee"))});b.isFunction=function(c){return o.call(c)=="[object Function]"};b.Pb=function(c){return o.call(c)=="[object String]"};b.Nb=function(c){return o.call(c)=="[object Number]"};b.Lc=function(c){return b.Nb(c)&&isFinite(c)};b.Mc=function(c){return c!==c};b.Ic=function(c){return c===j||c===l||o.call(c)=="[object Boolean]"};b.Jc=function(c){return o.call(c)=="[object Date]"};b.Oc=function(c){return o.call(c)=="[object RegExp]"};b.Nc=function(c){return c===
k};b.Pc=function(c){return c===h};b.has=function(c,b){return L.call(c,b)};b.noConflict=function(){p.ra=u;return this};b.P=function(c){return c};b.fd=function(c,b,a){for(var f=0;f<c;f++)b.call(a,f)};b.escape=function(c){return(""+c).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};b.result=function(c,a){if(c==k)return k;var f=c[a];return b.isFunction(f)?f.call(c):f};b.Tb=function(c){s(b.Aa(c),function(a){g(a,b[a]=
c[a])})};var Y=0;b.gd=function(c){var b=Y++;return c?c+b:b};b.mc={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var N=/.^/,A={"\\":"\\","'":"'",r:"\r",n:"\n",t:"\t",u2028:"\u2028",u2029:"\u2029"},O;for(O in A)A[A[O]]=O;var Z=/\\|'|\r|\n|\t|\u2028|\u2029/g,W=/\\(\\|'|r|n|t|u2028|u2029)/g;b.dd=function(c,f,d){function e(c){return g.call(this,c,b)}d=b.wb(d||{},b.mc);c="__p+='"+c.replace(Z,function(c){return"\\"+A[c]}).replace(d.escape||N,function(c,b){return"'+\n_.escape("+
a(b)+")+\n'"}).replace(d.interpolate||N,function(c,b){return"'+\n("+a(b)+")+\n'"}).replace(d.evaluate||N,function(c,b){return"';\n"+a(b)+"\n;__p+='"})+"';\n";d.La||(c="with(obj||{}){\n"+c+"}\n");var c="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+c+"return __p;\n",g=new Function(d.La||"obj","_",c);if(f)return g(f,b);e.source="function("+(d.La||"obj")+"){\n"+c+"}";return e};b.X=function(c){return b(c).X()};b.prototype=e.prototype;b.Tb(b);s("pop,push,reverse,shift,sort,splice,unshift".split(","),
function(c){var b=n[c];e.prototype[c]=function(){var a=this.z;b.apply(a,arguments);var f=a.length;(c=="shift"||c=="splice")&&f===0&&delete a[0];return d(a,this.C)}});s(["concat","join","slice"],function(c){var b=n[c];e.prototype[c]=function(){return d(b.apply(this.z,arguments),this.C)}});e.prototype.X=function(){this.C=j;return this};e.prototype.value=function(){return this.z}}).call(this);
(function(g){var d=String.fromCharCode,e;a:{try{document.createElement("$")}catch(a){e=a;break a}e=h}g.atob||(g.atob=function(a){var a=a.replace(/=+$/,""),b,g,p,u,q=0,n=a.length,t=[];if(1===n%4)throw e;for(;q<n;)b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(q++)),g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(q++)),p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(q++)),u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(q++)),
b=(b&63)<<2|g>>4&3,g=(g&15)<<4|p>>2&15,p=(p&3)<<6|u&63,t.push(d(b)),g&&t.push(d(g)),p&&t.push(d(p));return t.join("")})})(this);var r=google.maps;function w(g){return new r.LatLng(g[0],g[1])}var E;
E=function(){function g(){}g.prototype.q=k;g.prototype.K=function(d,e){this.Ya(d.split(" "),e)};g.prototype.Ya=function(d,e){var a,f,b;f=0;for(b=d.length;f<b;f++)a=d[f],this.sa(a),-1===this.q[a].indexOf(e)&&this.q[a].push(e)};g.prototype.N=function(d){var e,a,f,b;this.sa(d);f=this.q[d];b=[];e=0;for(a=f.length;e<a;e++)d=f[e],b.push(d(h));return b};g.prototype.sa=function(d){this.q||(this.q={});this.q[d]||(this.q[d]=[])};return g}();var J,K,P;
J=function(){function g(d,e,a){a==k&&(a={});this.c=d;this.viewport=e;this.options=a;this.Ea();this.rb();this.kb()}g.prototype.kb=function(){var d,e,a,f,b,g,p,u,q,n;this.f=new r.Map(this.c[0],this.Rb());this.bounds&&this.f.fitBounds(this.bounds);p=[];if("undefined"!==typeof MDC)for(e in d=MDC.uc.Rc,n=[],p){b=p[e];f=[];for(a in b)f.push(a);g=f.join("").split("");b=[];u=0;for(q=g.length;u<q;u++)f=g[u],b.push(String.fromCharCode(f.charCodeAt(0)-49));n.push(d[e]=parseInt(b.join("")))}};g.prototype.Rb=
function(){this.Ea();return _.extend({zoom:12,center:this.center,mapTypeId:r.MapTypeId.ROADMAP},this.options)};g.prototype.Ea=function(){this.viewport?(this.kc=new r.LatLng(this.viewport.southwest.lat,this.viewport.southwest.lng),this.Ub=new r.LatLng(this.viewport.northeast.lat,this.viewport.northeast.lng),this.bounds=new r.LatLngBounds(this.kc,this.Ub)):this.bounds=l};g.prototype.rb=function(){this.bounds?this.center=this.bounds.getCenter():this.center=new r.LatLng(0,0)};g.prototype.Hb=function(){var d,
e;d=this.f.getBounds();e=d.getSouthWest();d=d.getNorthEast();return{southwest:{lat:e.lat(),lng:e.lng()},northeast:{lat:d.lat(),lng:d.lng()}}};return g}();
K=function(){function g(d,e,a){this.Qb=this.map=d;this.f=this.Qb.f;this.k=e;this.options=a;this.$b();this.lb();this.pb()}g.prototype.lb=function(){this.Q=new r.Polyline(this.Zb())};g.prototype.pb=function(){var d,e,a;this.cc=[];e=this.k.length;if(1<e){e-=2;a=[];for(d=0;0<=e?d<=e:d>=e;0<=e?d++:d--)a.push(this.cc.push(new P(this.k[d],this.k[d+1],this.h[d],this.h[d+1])))}};g.prototype.$b=function(){var d,e,a,f,b;if(this.k[0]&&this.k[0].constructor===Array){this.h=new r.MVCArray([]);f=this.k;b=[];e=0;
for(a=f.length;e<a;e++)d=f[e],b.push(this.h.push(new r.LatLng(d[0],d[1])))}else{this.h=new r.MVCArray(this.k);d=[];b=this.k;a=0;for(f=b.length;a<f;a++)e=b[a],d.push([e.lat(),e.lng()]);this.k=d}};g.prototype.rc=function(d){d==k&&(d=k);d&&(this.h=new r.MVCArray(d));this.Q.setPath(this.h)};g.prototype.Zb=function(){return _.extend({map:this.f,path:this.h},this.options)};g.prototype.show=function(){return this.Q.setVisible(j)};g.prototype.hide=function(){return this.Q.setVisible(l)};return g}();
P=function(){function g(d,e,a,f){this.ha=d;this.ia=e;this.fa=a;this.ga=f;this.sb()}g.prototype.sb=function(){this.na=this.ha[0];this.oa=this.ha[1];this.Na=this.ia[0];this.Oa=this.ia[1];this.$=this.Na-this.na;this.aa=this.Oa-this.oa;this.U=180/Math.PI*Math.atan2(this.Oa-this.oa,this.Na-this.na);0>this.U&&(this.U+=360);this.distance=Math.sqrt(this.$*this.$+this.aa*this.aa)};g.prototype.Sb=function(){this.fa||(this.fa=w(this.ha));this.ga||(this.ga=w(this.ia))};g.prototype.interpolate=function(d){return[this.$*
d+this.na,this.aa*d+this.oa]};g.prototype.path=function(){this.Sb();return[this.fa,this.ga]};return g}();var Q,R,T,U;
Q=function(){function g(d){this.data=d;this.hb();this.ob();this.eb()}g.prototype.za=function(){};g.prototype.hb=function(){this.city=new R(this.data.city)};g.prototype.ob=function(){this.L=new T(this.city,this.data.L,"departure_route","red");this.J=new T(this.city,this.data.J,"return_route","blue");this.J.ka()};g.prototype.eb=function(){var d=this;this.L.K("change_tab",function(){d.L.ka();return d.J.p()});this.J.K("change_tab",function(){d.J.ka();return d.L.p()})};return g}();
R=function(){function g(d){this.data=d;this.W();this.ib()}g.prototype.W=function(){this.map=new J($(document.getElementById("map")),this.data.viewport);return this.f=this.map.f};g.prototype.ib=function(){this.M=new R.Pa(this.data.name,this.data.country,this.data.region_tag)};g.prototype.Eb=function(d,e){return this.M.H(d,e)};return g}();
R.Pa=function(){function g(d,e,a){this.city=d;this.country=e;this.region=a;this.jb()}g.prototype.jb=function(){this.Gb=new r.Geocoder};g.prototype.H=function(d,e){var a=this;return this.Gb.geocode(this.options(d),function(f,b){return"OK"===b?e(a.Xb(f[0])):e(l)})};g.prototype.options=function(d){return{address:""+d+", "+this.city+", "+this.country,region:this.region}};g.prototype.Xb=function(d){return d.geometry.location};return g}();$(function(){if($(document.body).is(".edit.admin_buses"))return new Q(window.bus_editor_data)});
U={};
(function(){function g(e,a){function f(){this.constructor=e}for(var b in a)d.call(a,b)&&(e[b]=a[b]);f.prototype=a.prototype;e.prototype=new f;e.i=a.prototype}var d=Object.prototype.hasOwnProperty;U.Ua=function(d){function a(f,b,d){a.i.constructor.call(this,f,b,d);this.V()}g(a,d);a.prototype.S=k;a.prototype.Ga=j;a.prototype.v=l;a.prototype.V=function(){var a=this;r.event.addListener(this.f,"click",function(b){return a.Za(b.latLng)});return this.ma()};a.prototype.Za=function(a){if(this.Ga)return 0===this.h.length?
this.S?(this.rc([this.S,a]),this.S=k):this.S=a:this.v?this.h.insertAt(0,a):this.h.push(a),this.ma()};a.prototype.ma=function(a){a==k&&(a=j);return this.Q.p(a,{s:a})};a.prototype.Jb=function(){return this.h.getArray()};a.prototype.ya=function(a){a==k&&(a=j);this.yb(a);this.ma(a)};a.prototype.yb=function(a){a==k&&(a=j);this.Ga=a};a.prototype.zb=function(a){return this.v=a};a.prototype.Ab=function(){return r.geometry.encoding.encodePath(this.h)};return a}(K)}).call(this);
(function(){function g(e,a){function f(){this.constructor=e}for(var b in a)d.call(a,b)&&(e[b]=a[b]);f.prototype=a.prototype;e.prototype=new f;e.i=a.prototype}var d=Object.prototype.hasOwnProperty;U.Qa=function(d){function a(f,b,d){this.l=b;a.i.constructor.call(this,f,this.tb(),d)}g(a,d);a.prototype.tb=function(){var a,b,d,e,g;this.Vb();e=this.l;g=[];b=0;for(d=e.length;b<d;b++)a=e[b],g.push([a.latitude,a.longitude]);return g};a.prototype.Vb=function(){this.l=this.l.sort(function(a,b){return a.B-b.B})};
a.prototype.nc=function(){var a,b,d,e,g,q;g=[];e=this.Jb();this.l.slice(0,e.length+1||9E9);q=this.l.slice(e.length);for(b in e)d=e[b],a=_.clone(this.l[b])||{},a.latitude=d.lat(),a.longitude=d.lng(),a.number=b,g.push(a);b=0;for(d=q.length;b<d;b++)a=q[b],a=_.clone(a),a._destroy=1,g.push(a);return g};return a}(U.Ua)}).call(this);
(function(){function g(e,a){function f(){this.constructor=e}for(var b in a)d.call(a,b)&&(e[b]=a[b]);f.prototype=a.prototype;e.prototype=new f;e.i=a.prototype}var d=Object.prototype.hasOwnProperty;T=function(d){function a(a,b,d,e){this.city=a;this.map=this.city.map;this.color=e;this.data=b;this.name=d;this.ba();this.bb();this.nb();this.gb()}g(a,d);a.prototype.ba=function(){this.c=$(document.getElementById(this.name));this.Ja=this.c.find("legend a");this.lc=this.Ja.filter("."+this.name+"_tab");return this.v=
this.c.find(".reverse_insertion")};a.prototype.bb=function(){var a=this,a=this;a.Ja.click(function(){if(this!==a.lc[0])return a.N("change_tab")});this.v.change(function(){return a.route.v(a.v.is(":checked"))})};a.prototype.nb=function(){this.route=new T.Sa(this.map,this.c,{strokeColor:this.color})};a.prototype.gb=function(){this.ta=new T.a(this.city,this.c)};a.prototype.p=function(){this.fc();this.route.hc();return this.ta.show()};a.prototype.ka=function(){this.Lb();this.route.jc();this.ta.hide()};
a.prototype.Lb=function(){this.c.hide()};a.prototype.fc=function(){this.c.show()};return a}(E)}).call(this);
T.a=function(){function g(d,e){this.city=d;this.parent=e;this.D={};this.o={};this.za();this.qb();this.fb()}g.prototype.za=function(){return this.element=this.c=this.parent.find("textarea")};g.prototype.qb=function(){this.T=new T.a.Xa(this.element)};g.prototype.fb=function(){var d=this;this.T.K("target_change",function(){return d.Ba()});this.T.K("change",function(){d.pc();return d.Ba()})};g.prototype.Ba=function(){var d;if(d=this.T.Kb())return this.oc(),this.Mb(d)};g.prototype.pc=function(){this.Ca();
this.qc();this.Ia()};g.prototype.qc=function(){var d,e,a,f;this.o={};f=this.T.D();e=0;for(a=f.length;e<a;e++)d=f[e],this.D[d.id]||(this.D[d.id]=new T.a.w(d,this.city)),this.o[d.id]=this.D[d.id]};g.prototype.Ia=function(){var d,e,a;a=this.o;for(e in a)d=a[e],d.show()};g.prototype.show=function(){return this.Ia()};g.prototype.Ca=function(){var d,e,a;a=this.o;for(e in a)d=a[e],d.hide()};g.prototype.hide=function(){return this.Ca()};g.prototype.Mb=function(d){if(this.o[d.id])return this.o[d.id].ca()};
g.prototype.oc=function(){var d,e,a;a=this.o;for(e in a)d=a[e],d.la()};return g}();
T.a.w=function(){function g(d,e){this.address=d;this.city=e}g.prototype.element=k;g.prototype.g=k;g.prototype.j=l;g.prototype.show=function(){return this.element?this.element.show():this.H()};g.prototype.hide=function(){if(this.element)return this.element.hide()};g.prototype.ca=function(){return this.element?this.element.ca():this.j=j};g.prototype.la=function(){return this.element?this.element.la():this.j=l};g.prototype.H=function(){var d=this;this.M||(this.M=new T.a.Ra(this.city,this.address));return this.M.H(function(e){if(d.g=
e)return 1===e.length?d.element=new T.a.m.Va(d.city.f,e[0],d.j):2<=e.length?d.element=new T.a.m.Ta(d.city.f,e,d.j):console.log("Something bad happened")})};return g}();T.a.w.qa=function(){function g(d){this.$a=d;this.Wb()}g.prototype.Wb=function(){var d,e,a;a=this.$a.split(">");d=[];var f,b,g;g=[];f=0;for(b=a.length;f<b;f++)e=a[f],d.push(e.Y),g.push(new T.a.w.Wa(e));this.R=g;this.id=this.R[0].A;this.A=this.R[0].A;this.Y=d.join(" | ");this.address=this.R[0].address;this.B=this.R[0].B};return g}();
T.a.w.Wa=function(){function g(d){this.street=d;this.Yb()}g.prototype.A=k;g.prototype.Y=k;g.prototype.address=k;g.prototype.B=k;g.prototype.Yb=function(){var d;if(d=this.street.match(/([^(]*)(?:\((.*)\))?/))if(this.A=d[1].replace(/^\s+|\s+$/g,""),this.Y=d[2],d=this.A.match(/(.+?)([0-9]*)?$/))this.address=d[1].replace(/^\s+|\s+$/g,""),this.B=d[2]};return g}();T.a.m={};
T.a.m.pa=function(){function g(d,e){this.f=d;this.j=e;this.ua()}g.prototype.visible=j;g.prototype.j=l;g.prototype.options=function(){return{map:this.f,clickable:l}};g.prototype.da=function(){return this.options()};g.prototype.xa=function(){return this.j?this.da():this.options()};g.prototype.show=function(){this.visible||this.element.setVisible(j);return this.visible=j};g.prototype.hide=function(){this.visible&&this.element.setVisible(l);return this.visible=l};g.prototype.ca=function(){this.j||this.element.setOptions(this.da());
return this.j=j};g.prototype.la=function(){this.j&&this.element.setOptions(this.options());return this.j=l};return g}();
(function(){function g(e,a){function f(){this.constructor=e}for(var b in a)d.call(a,b)&&(e[b]=a[b]);f.prototype=a.prototype;e.prototype=new f;e.i=a.prototype}var d=Object.prototype.hasOwnProperty;T.a.m.Ta=function(d){function a(d,b,e){this.g=b;a.i.constructor.call(this,d,e)}g(a,d);a.prototype.ua=function(){return this.element=new r.Polyline(this.xa())};a.prototype.options=function(){return _.extend(a.i.options.apply(this,arguments),{path:this.ub(),strokeColor:"green",strokeOpacity:0.75,strokeWeight:1})};
a.prototype.da=function(){return _.extend(this.options(),{strokeOpacity:1,strokeWeight:2})};a.prototype.ub=function(){var a,b;a=[this.g[0].lat(),this.g[0].lng()];b=[this.g[1].lat(),this.g[1].lng()];a=new P(a,b,this.g[0],this.g[1]);return[w(a.interpolate(-5)),w(a.interpolate(6))]};return a}(T.a.m.pa)}).call(this);
(function(){function g(e,a){function f(){this.constructor=e}for(var b in a)d.call(a,b)&&(e[b]=a[b]);f.prototype=a.prototype;e.prototype=new f;e.i=a.prototype}var d=Object.prototype.hasOwnProperty;T.a.m.Va=function(d){function a(d,b,e){this.result=b;a.i.constructor.call(this,d,e)}g(a,d);a.prototype.ua=function(){return this.element=new r.Marker(this.xa())};a.prototype.options=function(){return _.extend(a.i.options.apply(this,arguments),{position:this.result})};return a}(T.a.m.pa)}).call(this);
T.a.Ra=function(){function g(d,e){this.city=d;this.address=e;this.I=[];this.g=[]}g.prototype.ic=100;g.prototype.Cb=1E3;g.prototype.mb=function(){this.address.B?this.I.push(this.address.A):(this.I.push(""+this.address.address+" "+this.ic),this.I.push(""+this.address.address+" "+this.Cb))};g.prototype.H=function(d){var e,a,f,b,g;if(0===this.g.length){this.mb();this.Ha=0;b=this.I;g=[];a=0;for(f=b.length;a<f;a++)e=b[a],g.push(this.Fb(e,d));return g}return d(this.g)};g.prototype.Fb=function(d,e){var a=
this;return this.city.Eb(d,function(f){if(f){if(a.g.push(f),++a.Ha,a.Ha===a.I.length)return e(a.g)}else return console.log("Failed query!",d),e(l)})};return g}();
(function(){function g(e,a){function f(){this.constructor=e}for(var b in a)d.call(a,b)&&(e[b]=a[b]);f.prototype=a.prototype;e.prototype=new f;e.i=a.prototype}var d=Object.prototype.hasOwnProperty;T.a.Xa=function(d){function a(a){this.c=a;this.ab()}g(a,d);a.prototype.ab=function(){var a=this;this.c.keypress(function(b){if(13===b.keyCode)return a.N("change")});this.c.keyup(function(b){if(-1!==[38,40].indexOf(b.keyCode))return a.N("target_change")});this.c.mouseup(function(){return a.N("target_change")})};
a.prototype.Kb=function(){var a;a=this.Ib();a=new T.a.w.qa(a);return a.id?a:l};a.prototype.Ib=function(){var a,b;b=this.c.val();a=this.c.getSelection().start;return this.Fa(b,a)};a.prototype.Fa=function(a,b){var d,e;if(0>b)return a;e=a.lastIndexOf("\n",b-1)+1;d=a.indexOf("\n",b);-1===d&&(d=a.length);return(d=a.substr(e,d-e))?d:this.Fa(a,b-1)};a.prototype.D=function(){var a,b,d,e,g;b=[];g=this.c.val().replace(/^\s+|\s+$/,"").split(/\n+/);d=0;for(e=g.length;d<e;d++)a=g[d],a=new T.a.w.qa(a),a.id&&b.push(a);
return b};return a}(E)}).call(this);
T.Sa=function(){function g(d,e,a){this.Z=e;this.map=d;this.Z=e;this.bc();this.route=new U.Qa(this.map,this.l,a);this.V()}g.prototype.bc=function(){this.va=this.Z.find('[name$="[json_checkpoints_attributes]"]');this.Bb=this.Z.find('[name$="[encoded]"]');this.l=JSON.parse(this.va.val())};g.prototype.V=function(){var d=this;return google.maps.event.addListener(this.map.f,"mouseout",function(){return d.tc()})};g.prototype.tc=function(){this.va.val(JSON.stringify(this.route.nc()));return this.Bb.val(this.route.Ab())};
g.prototype.hc=function(){this.route.ya(j)};g.prototype.jc=function(){this.route.ya(l)};g.prototype.v=function(d){return this.route.zb(d)};return g}();var V;
V=function(){function g(){this.ba();this.W();this.cb()}g.prototype.ba=function(){this.c=this.element=$(document.getElementById("map"));this.Ma=$(document.getElementById("city_json_viewport"));try{return this.viewport=JSON.parse(this.Ma.val())}catch(d){return this.viewport=l}};g.prototype.W=function(){return this.map=new J(this.c,this.viewport)};g.prototype.cb=function(){var d=this;r.event.addListener(this.map.f,"bounds_changed",function(){return d.dc(d.map.Hb())})};g.prototype.dc=function(d){return this.Ma.val(JSON.stringify(d))};
return g}();$(function(){if($(document.body).is(".edit.admin_cities"))return new V});
jQuery.each({getSelection:function(){var g=this.jquery?this[0]:this;return("selectionStart"in g&&function(){var d=g.selectionEnd-g.selectionStart;return{start:g.selectionStart,end:g.selectionEnd,length:d,text:g.value.substr(g.selectionStart,d)}}||document.selection&&function(){g.focus();var d=document.selection.createRange();if(d===k)return{start:0,end:g.value.length,length:0};var e=g.createTextRange(),a=e.duplicate();e.moveToBookmark(d.getBookmark());a.setEndPoint("EndToStart",e);return{start:a.text.length,
end:a.text.length+d.text.length,length:d.text.length,text:d.text}}||function(){return k})()},Wc:function(g){var d="function"==typeof this.id?this.get(0):this,e=g||"";return("selectionStart"in d&&function(){d.value=d.value.substr(0,d.selectionStart)+e+d.value.substr(d.selectionEnd,d.value.length);return this}||document.selection&&function(){d.focus();document.selection.createRange().text=e;return this}||function(){d.value+=e;return jQuery(d)})()}},function(g){jQuery.fn[g]=this});
(function(g){if(google.maps.Polyline.prototype.p===g){var d=function(a,d){function b(){this.setIcon(I)}function e(){this.setIcon(C)}function p(){var b=this.getPosition();b.b=this;b.e=o(this.d).e;a.getPath().setAt(this.d,b);d.s&&z(this)}function u(){google.maps.event.trigger(a,"update_at",this.d,this.getPosition())}function q(){if(d.s){var b=o(this.d),e=o(this.d-1);b.e&&b.e.setMap(k);a.getPath().removeAt(this.d);e&&(this.d<a.getPath().getLength()?z(e.b):(e.e.setMap(k),e.e=g));this.setMap(k);a.getPath().forEach(function(a,
b){a.b&&(a.b.d=b)});1===a.getPath().getLength()&&a.getPath().pop().b.setMap(k);google.maps.event.trigger(a,"remove_at",this.d,b)}}function n(d){var f=d.b;return f||(f=new google.maps.Marker({position:d,map:a.getMap(),icon:C,draggable:j,raiseOnDrag:l}),google.maps.event.addListener(f,"mouseover",b),google.maps.event.addListener(f,"mouseout",e),google.maps.event.addListener(f,"drag",p),google.maps.event.addListener(f,"dragend",u),google.maps.event.addListener(f,"rightclick",q),d.b=f),f.setPosition(d),
f}d=d||{};d.s=d.s||d.s===g;d.u=d.u||google.maps.Polyline.prototype.p.ec.u;if(d.s)var t=new google.maps.MarkerImage(d.u+"ghostVertex.png",new google.maps.Size(11,11),new google.maps.Point(0,0),new google.maps.Point(6,6)),m=new google.maps.MarkerImage(d.u+"ghostVertexOver.png",new google.maps.Size(11,11),new google.maps.Point(0,0),new google.maps.Point(6,6)),x=new google.maps.Polyline({map:a.getMap(),strokeColor:a.strokeColor,strokeOpacity:0.2,strokeWeight:a.strokeWeight}),o=function(b){return a.getPath().getAt(b)},
L=function(){this.setIcon(m)},F=function(){this.setIcon(t)},G=function(){0===x.getPath().getLength()&&x.setPath([this.b.getPosition(),this.getPosition(),o(this.b.d+1)]);x.getPath().setAt(1,this.getPosition())},z=function(a){var b=o(a.d),d=o(a.d-1),e=o(a.d+1),a=a.getPosition();b&&b.e&&(google.maps.geometry?b.e.setPosition(google.maps.geometry.spherical.interpolate(b,e,0.5)):b.e.setPosition(new google.maps.LatLng(b.lat()+0.5*(e.lat()-b.lat()),b.lng()+0.5*(e.lng()-b.lng()))));d&&d.e&&(google.maps.geometry?
d.e.setPosition(google.maps.geometry.spherical.interpolate(d,a,0.5)):d.e.setPosition(new google.maps.LatLng(d.lat()+0.5*(a.lat()-d.lat()),d.lng()+0.5*(a.lng()-d.lng()))))},H=function(){var b=this.getPosition(),d=this.b.d+1;x.getPath().forEach(function(){x.getPath().pop()});a.getPath().insertAt(d,b);n(o(d)).d=d;z(this.b);B(o(d));a.getPath().forEach(function(a,b){a.b&&(a.b.d=b)});google.maps.event.trigger(a,"insert_at",d,b)},B=function(b){if(b.b.d<a.getPath().getLength()-1){var d=o(b.b.d+1),e;google.maps.geometry?
e=google.maps.geometry.spherical.interpolate(b,d,0.5):e=new google.maps.LatLng(b.lat()+0.5*(d.lat()-b.lat()),b.lng()+0.5*(d.lng()-b.lng()));(d=b.e)||(d=new google.maps.Marker({map:a.getMap(),icon:t,draggable:j,raiseOnDrag:l}),google.maps.event.addListener(d,"mouseover",L),google.maps.event.addListener(d,"mouseout",F),google.maps.event.addListener(d,"drag",G),google.maps.event.addListener(d,"dragend",H),b.e=d,d.b=b.b);d.setPosition(e)}};var C=new google.maps.MarkerImage(d.u+"vertex.png",new google.maps.Size(11,
11),new google.maps.Point(0,0),new google.maps.Point(6,6)),I=new google.maps.MarkerImage(d.u+"vertexOver.png",new google.maps.Size(11,11),new google.maps.Point(0,0),new google.maps.Point(6,6));a.getPath().forEach(function(a,b){n(a).d=b;d.s&&B(a)});google.maps.event.trigger(a,"edit_start")},e=function(a){a.getPath().forEach(function(a){a.b&&(a.b.setMap(k),a.b=g);a.e&&(a.e.setMap(k),a.e=g)});google.maps.event.trigger(a,"edit_end",a.getPath())};google.maps.Polyline.prototype.p=function(a,f){a||a===g?
(!f&&"object"==typeof a&&(f=a),d(this,f)):e(this)};google.maps.Polyline.prototype.p.ec={u:"/assets/polyline.edit/"}}})();
